"use strict";!function(){function e(e,t,n){e[t]||(e[t]=n)}e(Array.prototype,"unique",function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e}),e(HTMLElement.prototype,"addClass",function(){for(var e in arguments){var t=this.className?this.className.trim().replace(/\s+/g," ").split(" "):[],n=arguments[e]?arguments[e].trim().replace(/\s+/g," ").split(" "):[];this.className=t.concat(n).unique().join(" ")}}),e(HTMLElement.prototype,"height",function(){return this.getBoundingClientRect().height}),e(HTMLElement.prototype,"width",function(){return this.getBoundingClientRect().width}),e(Object,"keys",function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,a,s=[];for(r in i)e.call(i,r)&&s.push(r);if(t)for(a=0;a<o;a++)e.call(i,n[a])&&s.push(n[a]);return s}}())}(),function(){var e=function(){this.listeners={}};e.prototype.trigger=function(){for(var e=arguments[0],t=this.listeners[e]||[],n=0;n<t.length;n++)Array.prototype.splice.call(arguments,0,1),t[n].apply(null,arguments)},e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e){delete this.listeners[e]},e.prototype.off=function(e,t){if(this.listeners[e]){var n=this.listeners[e];n.indexOf(t)>-1&&n.splice(index,1)}},window.EventHandler=e}(),function(){function e(t,n){for(var o in n)if(n.hasOwnProperty(o)){var i=n[o];"object"==typeof i?e(t[o],n[o]):t[o]=n[o]}}var t=function(n){this.options={container:{selector:"#cobweb",className:"cb-container"},menu:{className:"cb-menu"},logger:{className:"cb-logger"}},n&&"object"==typeof n&&e(this.options,n),this.container=document.querySelector(this.options.container.selector),this.container.addClass(this.options.container.className),this.events=new EventHandler,this.events.on("core.resize",function(e){e.plugins.surface.gl.canvas.height=e.container.height(),e.plugins.surface.gl.canvas.width=e.container.width()}),t.prototype.plugins.load(this);var o=this;window.addEventListener("resize",function(e){o.events.trigger("core.resize",o)})};window.Cobweb=t}(),function(){Cobweb.prototype.plugins=new function(){this.available={},this.add=function(){var e,t,n;if(2==arguments.length){if(e=arguments[0],n=arguments[1],t=[],"string"!=typeof e)throw new Error("Parameter 1: expected string, found "+typeof e);if("function"!=typeof n)throw new Error("Parameter 1: expected function, found "+typeof n)}else{if(3!=arguments.length)throw new Error("Invalid parameters: must be 2 or 3, found "+arguments.length);if(e=arguments[0],t=arguments[1],n=arguments[2],"string"!=typeof e)throw new Error("Parameter 1: expected string, found "+typeof e);if("array"!=typeof t)throw new Error("Parameter 2: expected array, found "+typeof t);if("function"!=typeof n)throw new Error("Parameter 3: expected function, found "+typeof n)}this.available[e]={dependencies:t,callback:n}},this.load=function(e){e.plugins={};for(var t in this.available)try{var n=new this.available[t].callback(e);e.events.trigger("plugins.loaded",t),e.plugins[t]=n}catch(n){e.events.trigger("plugins.error",t,n)}e.events.trigger("plugins.loaded.all",Object.keys(e.plugins))}}}(),function(){var e=function(e){var t=document.createElement("DIV");t.addClass(e.options.logger.className),e.container.append(t);var n=document.createElement("DIV");n.innerHTML="Lorem ipsum...",n.addClass("info"),t.append(n),this.info=function(e){n.innerHTML=e},e.events.on("logger.info",this.info)};Cobweb.prototype.plugins.add("logger",e)}(),function(){var e=function(e){this.container=document.createElement("DIV"),this.container.addClass(e.options.menu.className),e.container.append(this.container);var t=document.createElement("UL");t.addClass("main-menu"),this.container.append(t),this.items={File:{"Load...":function(){console.log("item click!")}},"Alert!":function(){e.events.trigger("logger.info","LOOK AT ME! O_O"),window.setTimeout(function(){e.events.trigger("logger.info","STAPH!")},2e3)},Help:{"About WebMesh":function(){console.log("About what?!")}}},this.update=function(){for(var e in this.items){var t=document.createElement("LI");t.innerHTML=e,t.addClass(e);var n=this.items[e];"function"==typeof n&&(t.onclick=n);var o=this.container.querySelector(".main-menu");o.append(t)}},this.update()};Cobweb.prototype.plugins.add("menu",e)}(),function(){var e=function(e){this.gl=GL.create({height:e.container.height(),width:e.container.width()}),this.gl.animate();var t={};t.primitive=this.gl.TRIANGLES,t.model=mat4.create(),t.mesh=GL.Mesh.cube();var n=mat4.create(),o=mat4.create(),i=mat4.create(),r=mat4.create(),a=mat4.create();mat4.perspective(n,45*DEG2RAD,this.gl.canvas.width/this.gl.canvas.height,.1,1e3),mat4.lookAt(o,[0,10,10],[0,0,0],[0,1,0]);var s=new Shader("precision highp float;            attribute vec3 a_vertex;            attribute vec3 a_normal;            varying vec3 v_normal;            uniform mat4 u_mvp;            uniform mat4 u_model;            void main() {                v_normal = (u_model * vec4(a_normal,0.0)).xyz;                gl_Position = u_mvp * vec4(a_vertex,1.0);            }","precision highp float;            varying vec3 v_normal;            uniform vec3 u_lightvector;            uniform vec4 u_color;            void main() {              vec3 N = normalize(v_normal);              gl_FragColor = u_color * max(0.0, dot(u_lightvector,N));            }");this.gl.clearColor(.4,.4,.4,1),this.gl.enable(this.gl.DEPTH_TEST);var l={u_color:[1,1,1,1],u_lightvector:vec3.normalize(vec3.create(),[1,1,1]),u_model:i,u_mvp:r},c=this;this.gl.ondraw=function(){c.gl.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT),mat4.multiply(a,o,t.model),mat4.multiply(r,n,a),l.u_model=t.model,s.uniforms(l).draw(t.mesh,t.primitive)},this.gl.onupdate=function(e){mat4.rotateY(t.model,t.model,.2*e)},e.container.append(this.gl.canvas)};Cobweb.prototype.plugins.add("surface",e)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwiZXZlbnRzLmpzIiwiY29id2ViLmpzIiwicGx1Z2lucy5qcyIsImxvZ2dlci5qcyIsIm1lbnUuanMiLCJzdXJmYWNlLmpzIl0sIm5hbWVzIjpbInNhZmVPdmVycmlkZSIsInByb3RvdHlwZSIsInByb3BlcnR5IiwidmFsdWUiLCJBcnJheSIsImEiLCJ0aGlzIiwiY29uY2F0IiwiaSIsImxlbmd0aCIsImoiLCJzcGxpY2UiLCJIVE1MRWxlbWVudCIsImFyZ3VtZW50cyIsIm9sZENsYXNzTmFtZXMiLCJjbGFzc05hbWUiLCJ0cmltIiwicmVwbGFjZSIsInNwbGl0IiwibmV3Q2xhc3NOYW1lcyIsInVuaXF1ZSIsImpvaW4iLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJoZWlnaHQiLCJ3aWR0aCIsIk9iamVjdCIsImhhc093blByb3BlcnR5IiwiaGFzRG9udEVudW1CdWciLCJ0b1N0cmluZyIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwiZG9udEVudW1zIiwiZG9udEVudW1zTGVuZ3RoIiwib2JqIiwiVHlwZUVycm9yIiwicHJvcCIsInJlc3VsdCIsImNhbGwiLCJwdXNoIiwiRXZlbnRIYW5kbGVyIiwibGlzdGVuZXJzIiwidHJpZ2dlciIsIm5hbWUiLCJhcHBseSIsIm9uIiwiY2FsbGJhY2siLCJvZmYiLCJhcnJheSIsImluZGV4T2YiLCJpbmRleCIsIndpbmRvdyIsImV4dGVuZCIsInNvdXJjZSIsInByb3BlcnRpZXMiLCJDb2J3ZWIiLCJvcHRpb25zIiwiY29udGFpbmVyIiwic2VsZWN0b3IiLCJtZW51IiwibG9nZ2VyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWRkQ2xhc3MiLCJldmVudHMiLCJpbnN0YW5jZSIsInBsdWdpbnMiLCJzdXJmYWNlIiwiZ2wiLCJjYW52YXMiLCJsb2FkIiwic2NvcGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJhdmFpbGFibGUiLCJhZGQiLCJkZXAiLCJmdW5jIiwiRXJyb3IiLCJkZXBlbmRlbmNpZXMiLCJwbHVnaW4iLCJleCIsImtleXMiLCJMb2dnZXIiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kIiwiaW5mbyIsImlubmVySFRNTCIsInRleHQiLCJNZW51IiwiaXRlbXMiLCJGaWxlIiwiTG9hZC4uLiIsImNvbnNvbGUiLCJsb2ciLCJBbGVydCEiLCJzZXRUaW1lb3V0IiwiSGVscCIsIkFib3V0IFdlYk1lc2giLCJ1cGRhdGUiLCJpdGVtIiwibGkiLCJvbmNsaWNrIiwibWFpbk1lbnUiLCJTdXJmYWNlIiwiR0wiLCJjcmVhdGUiLCJhbmltYXRlIiwib2JqZWN0IiwicHJpbWl0aXZlIiwiVFJJQU5HTEVTIiwibW9kZWwiLCJtYXQ0IiwibWVzaCIsIk1lc2giLCJjdWJlIiwicHJvaiIsInZpZXciLCJtdnAiLCJ0ZW1wIiwicGVyc3BlY3RpdmUiLCJERUcyUkFEIiwibG9va0F0Iiwic2hhZGVyIiwiU2hhZGVyIiwiY2xlYXJDb2xvciIsImVuYWJsZSIsIkRFUFRIX1RFU1QiLCJ1bmlmb3JtcyIsInVfY29sb3IiLCJ1X2xpZ2h0dmVjdG9yIiwidmVjMyIsIm5vcm1hbGl6ZSIsInVfbW9kZWwiLCJ1X212cCIsIm9uZHJhdyIsImNsZWFyIiwiQ09MT1JfQlVGRkVSX0JJVCIsIkRFUFRIX0JVRkZFUl9CSVQiLCJtdWx0aXBseSJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQSxXQWlFQSxRQUFBQSxHQUFBQyxFQUFBQyxFQUFBQyxHQUNBRixFQUFBQyxLQUFBRCxFQUFBQyxHQUFBQyxHQWpFQUgsRUFBQUksTUFBQUgsVUFBQSxTQUFBLFdBRUEsSUFBQSxHQURBSSxHQUFBQyxLQUFBQyxTQUNBQyxFQUFBLEVBQUFBLEVBQUFILEVBQUFJLFNBQUFELEVBQ0EsSUFBQSxHQUFBRSxHQUFBRixFQUFBLEVBQUFFLEVBQUFMLEVBQUFJLFNBQUFDLEVBQ0FMLEVBQUFHLEtBQUFILEVBQUFLLElBQUFMLEVBQUFNLE9BQUFELElBQUEsRUFHQSxPQUFBTCxLQUdBTCxFQUFBWSxZQUFBWCxVQUFBLFdBQUEsV0FDQSxJ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RCxHQUFBMkQsV0FFQSxJQUFBQyxJQUNBQyxTQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0FDLGNBQUFDLEtBQUFDLFVBQUFELEtBQUF6QixVQUFBLEVBQUEsRUFBQSxJQUNBMkIsUUFBQXRCLEVBQ0F1QixNQUFBaEIsR0FHQS9DLEVBQUEvRCxJQUNBQSxNQUFBNEQsR0FBQW1FLE9BQUEsV0FDQWhFLEVBQUFILEdBQUFvRSxNQUFBakUsRUFBQUgsR0FBQXFFLGlCQUFBbEUsRUFBQUgsR0FBQXNFLGtCQUVBMUIsS0FBQTJCLFNBQUFwQixFQUFBRixFQUFBVCxFQUFBRyIsImZpbGUiOiJjb2J3ZWIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuKChmdW5jdGlvbigpe1xyXG4gICAgc2FmZU92ZXJyaWRlKEFycmF5LnByb3RvdHlwZSwgJ3VuaXF1ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhID0gdGhpcy5jb25jYXQoKTtcclxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBmb3IodmFyIGogPSBpICsgMTsgaiA8IGEubGVuZ3RoOyArK2opIHtcclxuICAgICAgICAgICAgICAgIGlmKGFbaV0gPT09IGFbal0pIGEuc3BsaWNlKGotLSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGE7XHJcbiAgICB9KTtcclxuXHJcbiAgICBzYWZlT3ZlcnJpZGUoSFRNTEVsZW1lbnQucHJvdG90eXBlLCAnYWRkQ2xhc3MnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBmb3IodmFyIGkgaW4gYXJndW1lbnRzKXtcclxuICAgICAgICAgICAgdmFyIG9sZENsYXNzTmFtZXMgPSAhdGhpcy5jbGFzc05hbWUgPyBbXSA6IHRoaXMuY2xhc3NOYW1lLnRyaW0oKS5yZXBsYWNlKC9cXHMrL2csICcgJykuc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgdmFyIG5ld0NsYXNzTmFtZXMgPSAhYXJndW1lbnRzW2ldID8gW10gOiBhcmd1bWVudHNbaV0udHJpbSgpLnJlcGxhY2UoL1xccysvZywgJyAnKS5zcGxpdCgnICcpO1xyXG4gICAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9IG9sZENsYXNzTmFtZXMuY29uY2F0KG5ld0NsYXNzTmFtZXMpLnVuaXF1ZSgpLmpvaW4oJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBzYWZlT3ZlcnJpZGUoSFRNTEVsZW1lbnQucHJvdG90eXBlLCAnaGVpZ2h0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xyXG4gICAgfSk7XHJcblxyXG4gICAgc2FmZU92ZXJyaWRlKEhUTUxFbGVtZW50LnByb3RvdHlwZSwgJ3dpZHRoJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XHJcbiAgICB9KTtcclxuXHJcbiAgICBzYWZlT3ZlcnJpZGUoT2JqZWN0LCAna2V5cycsIChmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LFxyXG4gICAgICAgICAgICBoYXNEb250RW51bUJ1ZyA9ICEoeyB0b1N0cmluZzogbnVsbCB9KS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgndG9TdHJpbmcnKSxcclxuICAgICAgICAgICAgZG9udEVudW1zID0gW1xyXG4gICAgICAgICAgICAgICd0b1N0cmluZycsXHJcbiAgICAgICAgICAgICAgJ3RvTG9jYWxlU3RyaW5nJyxcclxuICAgICAgICAgICAgICAndmFsdWVPZicsXHJcbiAgICAgICAgICAgICAgJ2hhc093blByb3BlcnR5JyxcclxuICAgICAgICAgICAgICAnaXNQcm90b3R5cGVPZicsXHJcbiAgICAgICAgICAgICAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJyxcclxuICAgICAgICAgICAgICAnY29uc3RydWN0b3InXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIGRvbnRFbnVtc0xlbmd0aCA9IGRvbnRFbnVtcy5sZW5ndGg7XHJcblxyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnICYmICh0eXBlb2Ygb2JqICE9PSAnZnVuY3Rpb24nIHx8IG9iaiA9PT0gbnVsbCkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5rZXlzIGNhbGxlZCBvbiBub24tb2JqZWN0Jyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXSwgcHJvcCwgaTtcclxuXHJcbiAgICAgICAgICAgIGZvciAocHJvcCBpbiBvYmopIHtcclxuICAgICAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChwcm9wKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGhhc0RvbnRFbnVtQnVnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZG9udEVudW1zTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGRvbnRFbnVtc1tpXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZG9udEVudW1zW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG4gIH0oKSkpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNhZmVPdmVycmlkZShwcm90b3R5cGUsIHByb3BlcnR5LCB2YWx1ZSkge1xyXG4gICAgICAgIGlmKCFwcm90b3R5cGVbcHJvcGVydHldKSBwcm90b3R5cGVbcHJvcGVydHldID0gdmFsdWU7XHJcbiAgICB9XHJcbn0pKCkpO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG4oKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIEV2ZW50SGFuZGxlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307XHJcbiAgICB9O1xyXG5cclxuICAgIEV2ZW50SGFuZGxlci5wcm90b3R5cGUudHJpZ2dlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBuYW1lID0gYXJndW1lbnRzWzBdO1xyXG4gICAgICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVyc1tuYW1lXSB8fCBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoYXJndW1lbnRzLCAwLCAxKTtcclxuICAgICAgICAgICAgbGlzdGVuZXJzW2ldLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBFdmVudEhhbmRsZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAoIXRoaXMubGlzdGVuZXJzW25hbWVdKSB0aGlzLmxpc3RlbmVyc1tuYW1lXSA9IFtdO1xyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzW25hbWVdLnB1c2goY2FsbGJhY2spO1xyXG4gICAgfTtcclxuXHJcbiAgICBFdmVudEhhbmRsZXIucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNbbmFtZV07XHJcbiAgICB9O1xyXG5cclxuICAgIEV2ZW50SGFuZGxlci5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNbbmFtZV0pIHtcclxuICAgICAgICAgICAgdmFyIGFycmF5ID0gdGhpcy5saXN0ZW5lcnNbbmFtZV07XHJcbiAgICAgICAgICAgIGlmIChhcnJheS5pbmRleE9mKGNhbGxiYWNrKSA+IC0xKSBhcnJheS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgd2luZG93LkV2ZW50SGFuZGxlciA9IEV2ZW50SGFuZGxlcjtcclxufSkoKSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbihmdW5jdGlvbigpe1xyXG4gICAgdmFyIENvYndlYiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lcjoge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICcjY29id2ViJyxcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NiLWNvbnRhaW5lcidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbWVudToge1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY2ItbWVudSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbG9nZ2VyOiB7XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjYi1sb2dnZXInXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0JylcclxuICAgICAgICAgICAgZXh0ZW5kKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLm9wdGlvbnMuY29udGFpbmVyLnNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuY29udGFpbmVyLmNsYXNzTmFtZSk7XHJcblxyXG4gICAgICAgIHRoaXMuZXZlbnRzID0gbmV3IEV2ZW50SGFuZGxlcigpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRzLm9uKCdjb3JlLnJlc2l6ZScsIGZ1bmN0aW9uKGluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnBsdWdpbnMuc3VyZmFjZS5nbC5jYW52YXMuaGVpZ2h0ID0gaW5zdGFuY2UuY29udGFpbmVyLmhlaWdodCgpO1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5wbHVnaW5zLnN1cmZhY2UuZ2wuY2FudmFzLndpZHRoID0gaW5zdGFuY2UuY29udGFpbmVyLndpZHRoKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgQ29id2ViLnByb3RvdHlwZS5wbHVnaW5zLmxvYWQodGhpcyk7XHJcblxyXG4gICAgICAgIHZhciBzY29wZSA9IHRoaXM7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHNjb3BlLmV2ZW50cy50cmlnZ2VyKCdjb3JlLnJlc2l6ZScsIHNjb3BlKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gZXh0ZW5kKHNvdXJjZSwgcHJvcGVydGllcyl7XHJcbiAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gcHJvcGVydGllcykge1xyXG4gICAgICAgICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHByb3BlcnRpZXNbcHJvcGVydHldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBleHRlbmQoc291cmNlW3Byb3BlcnR5XSwgcHJvcGVydGllc1twcm9wZXJ0eV0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzb3VyY2VbcHJvcGVydHldID0gcHJvcGVydGllc1twcm9wZXJ0eV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgd2luZG93LkNvYndlYiA9IENvYndlYjtcclxufSgpKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuKChmdW5jdGlvbiAoKSB7XHJcbiAgICBDb2J3ZWIucHJvdG90eXBlLnBsdWdpbnMgPSBuZXcgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5hdmFpbGFibGUgPSB7fTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIG5hbWUsIGRlcCwgZnVuYztcclxuXHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDIpIHtcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBhcmd1bWVudHNbMF07XHJcbiAgICAgICAgICAgICAgICBmdW5jID0gYXJndW1lbnRzWzFdO1xyXG4gICAgICAgICAgICAgICAgZGVwID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJykgdGhyb3cgbmV3IEVycm9yKCdQYXJhbWV0ZXIgMTogZXhwZWN0ZWQgc3RyaW5nLCBmb3VuZCAnICsgdHlwZW9mIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmdW5jICE9PSAnZnVuY3Rpb24nKSB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciAxOiBleHBlY3RlZCBmdW5jdGlvbiwgZm91bmQgJyArIHR5cGVvZiBmdW5jKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDMpIHtcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBhcmd1bWVudHNbMF07XHJcbiAgICAgICAgICAgICAgICBkZXAgPSBhcmd1bWVudHNbMV07XHJcbiAgICAgICAgICAgICAgICBmdW5jID0gYXJndW1lbnRzWzJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHRocm93IG5ldyBFcnJvcignUGFyYW1ldGVyIDE6IGV4cGVjdGVkIHN0cmluZywgZm91bmQgJyArIHR5cGVvZiBuYW1lKTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGVwICE9PSAnYXJyYXknKSB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciAyOiBleHBlY3RlZCBhcnJheSwgZm91bmQgJyArIHR5cGVvZiBkZXApO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmdW5jICE9PSAnZnVuY3Rpb24nKSB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciAzOiBleHBlY3RlZCBmdW5jdGlvbiwgZm91bmQgJyArIHR5cGVvZiBmdW5jKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBwYXJhbWV0ZXJzOiBtdXN0IGJlIDIgb3IgMywgZm91bmQgJyArIGFyZ3VtZW50cy5sZW5ndGgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmF2YWlsYWJsZVtuYW1lXSA9IHtcclxuICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogZGVwLFxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmNcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmxvYWQgPSBmdW5jdGlvbihpbnN0YW5jZSkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5wbHVnaW5zID0ge307XHJcbiAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcy5hdmFpbGFibGUpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsdWdpbiA9IG5ldyB0aGlzLmF2YWlsYWJsZVtuYW1lXS5jYWxsYmFjayhpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuZXZlbnRzLnRyaWdnZXIoJ3BsdWdpbnMubG9hZGVkJywgbmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UucGx1Z2luc1tuYW1lXSA9IHBsdWdpbjtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuZXZlbnRzLnRyaWdnZXIoJ3BsdWdpbnMuZXJyb3InLCBuYW1lLCBleCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW5zdGFuY2UuZXZlbnRzLnRyaWdnZXIoJ3BsdWdpbnMubG9hZGVkLmFsbCcsIE9iamVjdC5rZXlzKGluc3RhbmNlLnBsdWdpbnMpKTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbigoZnVuY3Rpb24oKXtcclxuICAgIHZhciBMb2dnZXIgPSBmdW5jdGlvbihpbnN0YW5jZSkge1xyXG4gICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdESVYnKTtcclxuICAgICAgICBjb250YWluZXIuYWRkQ2xhc3MoaW5zdGFuY2Uub3B0aW9ucy5sb2dnZXIuY2xhc3NOYW1lKTtcclxuICAgICAgICBpbnN0YW5jZS5jb250YWluZXIuYXBwZW5kKGNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIHZhciBpbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XHJcbiAgICAgICAgaW5mby5pbm5lckhUTUwgPSAnTG9yZW0gaXBzdW0uLi4nO1xyXG4gICAgICAgIGluZm8uYWRkQ2xhc3MoJ2luZm8nKTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKGluZm8pO1xyXG5cclxuICAgICAgICB0aGlzLmluZm8gPSBmdW5jdGlvbih0ZXh0KSB7XHJcbiAgICAgICAgICAgIGluZm8uaW5uZXJIVE1MID0gdGV4dDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGluc3RhbmNlLmV2ZW50cy5vbignbG9nZ2VyLmluZm8nLCB0aGlzLmluZm8pO1xyXG4gICAgfTtcclxuXHJcbiAgICBDb2J3ZWIucHJvdG90eXBlLnBsdWdpbnMuYWRkKCdsb2dnZXInLCBMb2dnZXIpO1xyXG59KSgpKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuKChmdW5jdGlvbigpe1xyXG4gICAgdmFyIE1lbnUgPSBmdW5jdGlvbihpbnN0YW5jZSkge1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoaW5zdGFuY2Uub3B0aW9ucy5tZW51LmNsYXNzTmFtZSk7XHJcbiAgICAgICAgaW5zdGFuY2UuY29udGFpbmVyLmFwcGVuZCh0aGlzLmNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIHZhciBtZW51ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVUwnKTtcclxuICAgICAgICBtZW51LmFkZENsYXNzKCdtYWluLW1lbnUnKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQobWVudSk7XHJcblxyXG4gICAgICAgIHRoaXMuaXRlbXMgPSB7XHJcbiAgICAgICAgICAgICdGaWxlJzoge1xyXG4gICAgICAgICAgICAgICAgJ0xvYWQuLi4nOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnaXRlbSBjbGljayEnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ0FsZXJ0ISc6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZXZlbnRzLnRyaWdnZXIoJ2xvZ2dlci5pbmZvJywgJ0xPT0sgQVQgTUUhIE9fTycpO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5ldmVudHMudHJpZ2dlcignbG9nZ2VyLmluZm8nLCAnU1RBUEghJyk7XHJcbiAgICAgICAgICAgICAgICB9LCAyMDAwKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ0hlbHAnOiB7XHJcbiAgICAgICAgICAgICAgICAnQWJvdXQgV2ViTWVzaCc6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBYm91dCB3aGF0PyEnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaXRlbSBpbiB0aGlzLml0ZW1zKXtcclxuICAgICAgICAgICAgICAgIHZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0xJJyk7XHJcbiAgICAgICAgICAgICAgICBsaS5pbm5lckhUTUwgPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgbGkuYWRkQ2xhc3MoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5pdGVtc1tpdGVtXTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBsaS5vbmNsaWNrID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1haW5NZW51ID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignLm1haW4tbWVudScpO1xyXG4gICAgICAgICAgICAgICAgbWFpbk1lbnUuYXBwZW5kKGxpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIENvYndlYi5wcm90b3R5cGUucGx1Z2lucy5hZGQoJ21lbnUnLCBNZW51KTtcclxufSkoKSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbigoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIFN1cmZhY2UgPSBmdW5jdGlvbihpbnN0YW5jZSkge1xyXG4gICAgICAgIHRoaXMuZ2wgPSBHTC5jcmVhdGUoe1xyXG4gICAgICAgICAgICBoZWlnaHQ6IGluc3RhbmNlLmNvbnRhaW5lci5oZWlnaHQoKSxcclxuICAgICAgICAgICAgd2lkdGg6IGluc3RhbmNlLmNvbnRhaW5lci53aWR0aCgpXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZ2wuYW5pbWF0ZSgpO1xyXG5cclxuICAgICAgICB2YXIgb2JqZWN0ID0ge307XHJcbiAgICAgICAgb2JqZWN0LnByaW1pdGl2ZSA9IHRoaXMuZ2wuVFJJQU5HTEVTO1xyXG4gICAgICAgIG9iamVjdC5tb2RlbCA9IG1hdDQuY3JlYXRlKCk7XHJcbiAgICAgICAgb2JqZWN0Lm1lc2ggPSBHTC5NZXNoLmN1YmUoKTtcclxuXHJcbiAgICAgICAgdmFyIHByb2ogPSBtYXQ0LmNyZWF0ZSgpO1xyXG4gICAgICAgIHZhciB2aWV3ID0gbWF0NC5jcmVhdGUoKTtcclxuICAgICAgICB2YXIgbW9kZWwgPSBtYXQ0LmNyZWF0ZSgpO1xyXG4gICAgICAgIHZhciBtdnAgPSBtYXQ0LmNyZWF0ZSgpO1xyXG4gICAgICAgIHZhciB0ZW1wID0gbWF0NC5jcmVhdGUoKTtcclxuXHJcbiAgICAgICAgbWF0NC5wZXJzcGVjdGl2ZShwcm9qLCA0NSAqIERFRzJSQUQsIHRoaXMuZ2wuY2FudmFzLndpZHRoIC8gdGhpcy5nbC5jYW52YXMuaGVpZ2h0LCAwLjEsIDEwMDApO1xyXG4gICAgICAgIG1hdDQubG9va0F0KHZpZXcsIFswLDEwLDEwXSxbMCwwLDBdLCBbMCwxLDBdKTtcclxuXHJcbiAgICAgICAgdmFyIHNoYWRlciA9IG5ldyBTaGFkZXIoXHJcbiAgICAgICAgICAgICdwcmVjaXNpb24gaGlnaHAgZmxvYXQ7XFxcclxuICAgICAgICAgICAgYXR0cmlidXRlIHZlYzMgYV92ZXJ0ZXg7XFxcclxuICAgICAgICAgICAgYXR0cmlidXRlIHZlYzMgYV9ub3JtYWw7XFxcclxuICAgICAgICAgICAgdmFyeWluZyB2ZWMzIHZfbm9ybWFsO1xcXHJcbiAgICAgICAgICAgIHVuaWZvcm0gbWF0NCB1X212cDtcXFxyXG4gICAgICAgICAgICB1bmlmb3JtIG1hdDQgdV9tb2RlbDtcXFxyXG4gICAgICAgICAgICB2b2lkIG1haW4oKSB7XFxcclxuICAgICAgICAgICAgICAgIHZfbm9ybWFsID0gKHVfbW9kZWwgKiB2ZWM0KGFfbm9ybWFsLDAuMCkpLnh5ejtcXFxyXG4gICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSB1X212cCAqIHZlYzQoYV92ZXJ0ZXgsMS4wKTtcXFxyXG4gICAgICAgICAgICB9JyxcclxuICAgICAgICAgICAgJ3ByZWNpc2lvbiBoaWdocCBmbG9hdDtcXFxyXG4gICAgICAgICAgICB2YXJ5aW5nIHZlYzMgdl9ub3JtYWw7XFxcclxuICAgICAgICAgICAgdW5pZm9ybSB2ZWMzIHVfbGlnaHR2ZWN0b3I7XFxcclxuICAgICAgICAgICAgdW5pZm9ybSB2ZWM0IHVfY29sb3I7XFxcclxuICAgICAgICAgICAgdm9pZCBtYWluKCkge1xcXHJcbiAgICAgICAgICAgICAgdmVjMyBOID0gbm9ybWFsaXplKHZfbm9ybWFsKTtcXFxyXG4gICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHVfY29sb3IgKiBtYXgoMC4wLCBkb3QodV9saWdodHZlY3RvcixOKSk7XFxcclxuICAgICAgICAgICAgfSdcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICB0aGlzLmdsLmNsZWFyQ29sb3IoMC40LCAwLjQsIDAuNCwgMSk7XHJcbiAgICAgICAgdGhpcy5nbC5lbmFibGUodGhpcy5nbC5ERVBUSF9URVNUKTtcclxuXHJcbiAgICAgICAgdmFyIHVuaWZvcm1zID0ge1xyXG4gICAgICAgICAgICB1X2NvbG9yOiBbMSwgMSwgMSwgMV0sXHJcbiAgICAgICAgICAgIHVfbGlnaHR2ZWN0b3I6IHZlYzMubm9ybWFsaXplKHZlYzMuY3JlYXRlKCksWzEsIDEsIDFdKSxcclxuICAgICAgICAgICAgdV9tb2RlbDogbW9kZWwsXHJcbiAgICAgICAgICAgIHVfbXZwOiBtdnBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2NvcGUgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2wub25kcmF3ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHNjb3BlLmdsLmNsZWFyKHNjb3BlLmdsLkNPTE9SX0JVRkZFUl9CSVQgfCBzY29wZS5nbC5ERVBUSF9CVUZGRVJfQklUKTtcclxuXHJcbiAgICAgICAgICAgIG1hdDQubXVsdGlwbHkodGVtcCwgdmlldywgb2JqZWN0Lm1vZGVsKTtcclxuICAgICAgICAgICAgbWF0NC5tdWx0aXBseShtdnAsIHByb2osIHRlbXApO1xyXG5cclxuICAgICAgICAgICAgdW5pZm9ybXMudV9tb2RlbCA9IG9iamVjdC5tb2RlbDtcclxuICAgICAgICAgICAgc2hhZGVyLnVuaWZvcm1zKHVuaWZvcm1zKS5kcmF3KG9iamVjdC5tZXNoLCBvYmplY3QucHJpbWl0aXZlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmdsLm9udXBkYXRlID0gZnVuY3Rpb24oZHQpIHtcclxuICAgICAgICAgICAgbWF0NC5yb3RhdGVZKG9iamVjdC5tb2RlbCwgb2JqZWN0Lm1vZGVsLCBkdCAqIDAuMik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW5zdGFuY2UuY29udGFpbmVyLmFwcGVuZCh0aGlzLmdsLmNhbnZhcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIENvYndlYi5wcm90b3R5cGUucGx1Z2lucy5hZGQoJ3N1cmZhY2UnLCBTdXJmYWNlKTtcclxufSkoKSk7XHJcbiJdfQ==
