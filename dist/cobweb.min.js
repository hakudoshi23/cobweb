"use strict";!function(){function e(e,t,n){e[t]||(e[t]=n)}e(Array.prototype,"unique",function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e}),e(HTMLElement.prototype,"addClass",function(){for(var e in arguments){var t=this.className?this.className.trim().replace(/\s+/g," ").split(" "):[],n=arguments[e]?arguments[e].trim().replace(/\s+/g," ").split(" "):[];this.className=t.concat(n).unique().join(" ")}}),e(HTMLElement.prototype,"height",function(){return this.getBoundingClientRect().height}),e(HTMLElement.prototype,"width",function(){return this.getBoundingClientRect().width}),e(Object,"keys",function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,a,s=[];for(r in i)e.call(i,r)&&s.push(r);if(t)for(a=0;a<o;a++)e.call(i,n[a])&&s.push(n[a]);return s}}())}(),function(){var e=function(){this.listeners={}};e.prototype.trigger=function(){for(var e=arguments[0],t=this.listeners[e]||[],n=0;n<t.length;n++)Array.prototype.splice.call(arguments,0,1),t[n].apply(null,arguments)},e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e){delete this.listeners[e]},e.prototype.off=function(e,t){if(this.listeners[e]){var n=this.listeners[e];n.indexOf(t)>-1&&n.splice(index,1)}},window.EventHandler=e}(),function(){function e(t,n){for(var o in n)if(n.hasOwnProperty(o)){var i=n[o];"object"==typeof i?e(t[o],n[o]):t[o]=n[o]}}var t=function(n){this.options={container:{selector:"#cobweb",className:"cb-container"},menu:{className:"cb-menu"},logger:{className:"cb-logger"}},n&&"object"==typeof n&&e(this.options,n),this.container=document.querySelector(this.options.container.selector),this.container.addClass(this.options.container.className),this.events=new EventHandler,this.events.on("core.resize",function(e){e.plugins.surface.gl.canvas.height=e.container.height(),e.plugins.surface.gl.canvas.width=e.container.width()}),t.prototype.plugins.load(this);var o=this;window.addEventListener("resize",function(e){o.events.trigger("core.resize",o)})};window.Cobweb=t}(),function(){Cobweb.prototype.plugins=new function(){this.available={},this.add=function(){var e,t,n;if(2==arguments.length){if(e=arguments[0],n=arguments[1],t=[],"string"!=typeof e)throw new Error("Parameter 1: expected string, found "+typeof e);if("function"!=typeof n)throw new Error("Parameter 1: expected function, found "+typeof n)}else{if(3!=arguments.length)throw new Error("Invalid parameters: must be 2 or 3, found "+arguments.length);if(e=arguments[0],t=arguments[1],n=arguments[2],"string"!=typeof e)throw new Error("Parameter 1: expected string, found "+typeof e);if("array"!=typeof t)throw new Error("Parameter 2: expected array, found "+typeof t);if("function"!=typeof n)throw new Error("Parameter 3: expected function, found "+typeof n)}this.available[e]={dependencies:t,callback:n}},this.load=function(e){e.plugins={};for(var t in this.available)try{var n=new this.available[t].callback(e);e.events.trigger("plugins.loaded",t),e.plugins[t]=n}catch(n){e.events.trigger("plugins.error",t,n)}e.events.trigger("plugins.loaded.all",Object.keys(e.plugins))}}}(),function(){var e=function(e){var t=document.createElement("DIV");t.addClass(e.options.logger.className),e.container.append(t);var n=document.createElement("DIV");n.innerHTML="Lorem ipsum...",n.addClass("info"),t.append(n),this.info=function(e){n.innerHTML=e},e.events.on("logger.info",this.info)};Cobweb.prototype.plugins.add("logger",e)}(),function(){var e=function(e){this.container=document.createElement("DIV"),this.container.addClass(e.options.menu.className),e.container.append(this.container);var t=document.createElement("UL");t.addClass("main-menu"),this.container.append(t),this.items={File:{"Load...":function(){console.log("item click!")}},"Alert!":function(){e.events.trigger("logger.info","LOOK AT ME! O_O"),window.setTimeout(function(){e.events.trigger("logger.info","STAPH!")},2e3)},Help:{"About WebMesh":function(){console.log("About what?!")}}},this.update=function(){for(var e in this.items){var t=document.createElement("LI");t.innerHTML=e,t.addClass(e);var n=this.items[e];"function"==typeof n&&(t.onclick=n);var o=this.container.querySelector(".main-menu");o.append(t)}},this.update()};Cobweb.prototype.plugins.add("menu",e)}(),function(){var e=function(e){this.gl=GL.create({height:e.container.height(),width:e.container.width()}),this.gl.animate();var t=[];t[0]={},t[0].primitive=this.gl.TRIANGLES,t[0].model=mat4.create(),t[0].mesh=GL.Mesh.cube(),mat4.translate(t[0].model,t[0].model,[-2,0,0]),t[1]={},t[1].primitive=this.gl.TRIANGLES,t[1].model=mat4.create(),t[1].mesh=GL.Mesh.sphere(),mat4.translate(t[1].model,t[1].model,[2,0,0]),t[2]={},t[2].primitive=this.gl.TRIANGLES,t[2].model=mat4.create(),t[2].mesh=GL.Mesh.cylinder({radius:.5}),mat4.translate(t[2].model,t[2].model,[0,0,-2]);var n=mat4.create(),o=mat4.create(),i=mat4.create(),r=mat4.create(),a=mat4.create();mat4.perspective(n,45*DEG2RAD,this.gl.canvas.width/this.gl.canvas.height,.1,1e3),mat4.lookAt(o,[0,5,5],[0,0,0],[0,1,0]);var s=new Shader("precision highp float;            attribute vec3 a_vertex;            attribute vec3 a_normal;            varying vec3 v_normal;            uniform mat4 u_mvp;            uniform mat4 u_model;            void main() {                v_normal = (u_model * vec4(a_normal,0.0)).xyz;                gl_Position = u_mvp * vec4(a_vertex,1.0);            }","precision highp float;            varying vec3 v_normal;            uniform vec3 u_lightvector;            uniform vec4 u_color;            void main() {              vec3 N = normalize(v_normal);              gl_FragColor = u_color * max(0.0, dot(u_lightvector,N));            }");this.gl.clearColor(.4,.4,.4,1),this.gl.enable(this.gl.DEPTH_TEST);var l={u_color:[1,1,1,1],u_lightvector:vec3.normalize(vec3.create(),[1,1,1]),u_model:i,u_mvp:r},c=this;this.gl.ondraw=function(){c.gl.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT),t.forEach(function(e){mat4.multiply(a,o,e.model),mat4.multiply(r,n,a),l.u_model=e.model,s.uniforms(l).draw(e.mesh,e.primitive)})},this.gl.onupdate=function(e){t.forEach(function(t){mat4.rotateY(t.model,t.model,.2*e)})},e.container.append(this.gl.canvas)};Cobweb.prototype.plugins.add("surface",e)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwiZXZlbnRzLmpzIiwiY29id2ViLmpzIiwicGx1Z2lucy5qcyIsImxvZ2dlci5qcyIsIm1lbnUuanMiLCJzdXJmYWNlLmpzIl0sIm5hbWVzIjpbInNhZmVPdmVycmlkZSIsInByb3RvdHlwZSIsInByb3BlcnR5IiwidmFsdWUiLCJBcnJheSIsImEiLCJ0aGlzIiwiY29uY2F0IiwiaSIsImxlbmd0aCIsImoiLCJzcGxpY2UiLCJIVE1MRWxlbWVudCIsImFyZ3VtZW50cyIsIm9sZENsYXNzTmFtZXMiLCJjbGFzc05hbWUiLCJ0cmltIiwicmVwbGFjZSIsInNwbGl0IiwibmV3Q2xhc3NOYW1lcyIsInVuaXF1ZSIsImpvaW4iLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJoZWlnaHQiLCJ3aWR0aCIsIk9iamVjdCIsImhhc093blByb3BlcnR5IiwiaGFzRG9udEVudW1CdWciLCJ0b1N0cmluZyIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwiZG9udEVudW1zIiwiZG9udEVudW1zTGVuZ3RoIiwib2JqIiwiVHlwZUVycm9yIiwicHJvcCIsInJlc3VsdCIsImNhbGwiLCJwdXNoIiwiRXZlbnRIYW5kbGVyIiwibGlzdGVuZXJzIiwidHJpZ2dlciIsIm5hbWUiLCJhcHBseSIsIm9uIiwiY2FsbGJhY2siLCJvZmYiLCJhcnJheSIsImluZGV4T2YiLCJpbmRleCIsIndpbmRvdyIsImV4dGVuZCIsInNvdXJjZSIsInByb3BlcnRpZXMiLCJDb2J3ZWIiLCJvcHRpb25zIiwiY29udGFpbmVyIiwic2VsZWN0b3IiLCJtZW51IiwibG9nZ2VyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWRkQ2xhc3MiLCJldmVudHMiLCJpbnN0YW5jZSIsInBsdWdpbnMiLCJzdXJmYWNlIiwiZ2wiLCJjYW52YXMiLCJsb2FkIiwic2NvcGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJhdmFpbGFibGUiLCJhZGQiLCJkZXAiLCJmdW5jIiwiRXJyb3IiLCJkZXBlbmRlbmNpZXMiLCJwbHVnaW4iLCJleCIsImtleXMiLCJMb2dnZXIiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kIiwiaW5mbyIsImlubmVySFRNTCIsInRleHQiLCJNZW51IiwiaXRlbXMiLCJGaWxlIiwiTG9hZC4uLiIsImNvbnNvbGUiLCJsb2ciLCJBbGVydCEiLCJzZXRUaW1lb3V0IiwiSGVscCIsIkFib3V0IFdlYk1lc2giLCJ1cGRhdGUiLCJpdGVtIiwibGkiLCJvbmNsaWNrIiwibWFpbk1lbnUiLCJTdXJmYWNlIiwiR0wiLCJjcmVhdGUiLCJhbmltYXRlIiwib2JqcyIsInByaW1pdGl2ZSIsIlRSSUFOR0xFUyIsIm1vZGVsIiwibWF0NCIsIm1lc2giLCJNZXNoIiwiY3ViZSIsInRyYW5zbGF0ZSIsInNwaGVyZSIsImN5bGluZGVyIiwicmFkaXVzIiwicHJvaiIsInZpZXciLCJtdnAiLCJ0ZW1wIiwicGVyc3BlY3RpdmUiLCJERUcyUkFEIiwibG9va0F0Iiwic2hhZGVyIiwiU2hhZGVyIiwiY2xlYXJDb2xvciIsImVuYWJsZSIsIkRFUFRIX1RFU1QiLCJ1bmlmb3JtcyIsInVfY29sb3IiLCJ1X2xpZ2h0dmVjdG9yIiwidmVjMyIsIm5vcm1hbGl6ZSIsInVfbW9kZWwiLCJ1X212cCIsIm9uZHJhdyIsImNsZWFyIiwiQ09MT1JfQlVGRkVSX0JJVCIsIkRFUFRIX0JVRkZFUl9CSVQiLCJmb3JFYWNoIiwibXVsdGlwbHkiXSwibWFwcGluZ3MiOiJBQUFBLGNBRUEsV0FpRUEsUUFBQUEsR0FBQUMsRUFBQUMsRUFBQUMsR0FDQUYsRUFBQUMsS0FBQUQsRUFBQUMsR0FBQUMsR0FqRUFILEVBQUFJLE1BQUFILFVBQUEsU0FBQSxXQUVBLElBQUEsR0FEQUksR0FBQUMsS0FBQUMsU0FDQUMsRUFBQSxFQUFBQSxFQUFBSCxFQUFBSSxTQUFBRCxFQUNBLElBQUEsR0FBQUUsR0FBQUYsRUFBQSxFQUFBRSxFQUFBTCxFQUFBSSxTQUFBQyxFQUNBTCxFQUFBRyxLQUFBSCxFQUFBSyxJQUFBTCxFQUFBTSxPQUFBRCxJ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XHJcbigoZnVuY3Rpb24oKXtcclxuICAgIHNhZmVPdmVycmlkZShBcnJheS5wcm90b3R5cGUsICd1bmlxdWUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYSA9IHRoaXMuY29uY2F0KCk7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgZm9yKHZhciBqID0gaSArIDE7IGogPCBhLmxlbmd0aDsgKytqKSB7XHJcbiAgICAgICAgICAgICAgICBpZihhW2ldID09PSBhW2pdKSBhLnNwbGljZShqLS0sIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc2FmZU92ZXJyaWRlKEhUTUxFbGVtZW50LnByb3RvdHlwZSwgJ2FkZENsYXNzJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgZm9yKHZhciBpIGluIGFyZ3VtZW50cyl7XHJcbiAgICAgICAgICAgIHZhciBvbGRDbGFzc05hbWVzID0gIXRoaXMuY2xhc3NOYW1lID8gW10gOiB0aGlzLmNsYXNzTmFtZS50cmltKCkucmVwbGFjZSgvXFxzKy9nLCAnICcpLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIHZhciBuZXdDbGFzc05hbWVzID0gIWFyZ3VtZW50c1tpXSA/IFtdIDogYXJndW1lbnRzW2ldLnRyaW0oKS5yZXBsYWNlKC9cXHMrL2csICcgJykuc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSBvbGRDbGFzc05hbWVzLmNvbmNhdChuZXdDbGFzc05hbWVzKS51bmlxdWUoKS5qb2luKCcgJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgc2FmZU92ZXJyaWRlKEhUTUxFbGVtZW50LnByb3RvdHlwZSwgJ2hlaWdodCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcclxuICAgIH0pO1xyXG5cclxuICAgIHNhZmVPdmVycmlkZShIVE1MRWxlbWVudC5wcm90b3R5cGUsICd3aWR0aCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc2FmZU92ZXJyaWRlKE9iamVjdCwgJ2tleXMnLCAoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGhhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxcclxuICAgICAgICAgICAgaGFzRG9udEVudW1CdWcgPSAhKHsgdG9TdHJpbmc6IG51bGwgfSkucHJvcGVydHlJc0VudW1lcmFibGUoJ3RvU3RyaW5nJyksXHJcbiAgICAgICAgICAgIGRvbnRFbnVtcyA9IFtcclxuICAgICAgICAgICAgICAndG9TdHJpbmcnLFxyXG4gICAgICAgICAgICAgICd0b0xvY2FsZVN0cmluZycsXHJcbiAgICAgICAgICAgICAgJ3ZhbHVlT2YnLFxyXG4gICAgICAgICAgICAgICdoYXNPd25Qcm9wZXJ0eScsXHJcbiAgICAgICAgICAgICAgJ2lzUHJvdG90eXBlT2YnLFxyXG4gICAgICAgICAgICAgICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsXHJcbiAgICAgICAgICAgICAgJ2NvbnN0cnVjdG9yJ1xyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICBkb250RW51bXNMZW5ndGggPSBkb250RW51bXMubGVuZ3RoO1xyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyAmJiAodHlwZW9mIG9iaiAhPT0gJ2Z1bmN0aW9uJyB8fCBvYmogPT09IG51bGwpKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3Qua2V5cyBjYWxsZWQgb24gbm9uLW9iamVjdCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW10sIHByb3AsIGk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHByb3AgaW4gb2JqKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocHJvcCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChoYXNEb250RW51bUJ1Zykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRvbnRFbnVtc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqLCBkb250RW51bXNbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGRvbnRFbnVtc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICB9KCkpKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzYWZlT3ZlcnJpZGUocHJvdG90eXBlLCBwcm9wZXJ0eSwgdmFsdWUpIHtcclxuICAgICAgICBpZighcHJvdG90eXBlW3Byb3BlcnR5XSkgcHJvdG90eXBlW3Byb3BlcnR5XSA9IHZhbHVlO1xyXG4gICAgfVxyXG59KSgpKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuKChmdW5jdGlvbigpIHtcclxuICAgIHZhciBFdmVudEhhbmRsZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB0aGlzLmxpc3RlbmVycyA9IHt9O1xyXG4gICAgfTtcclxuXHJcbiAgICBFdmVudEhhbmRsZXIucHJvdG90eXBlLnRyaWdnZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbmFtZSA9IGFyZ3VtZW50c1swXTtcclxuICAgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnNbbmFtZV0gfHwgW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnNwbGljZS5jYWxsKGFyZ3VtZW50cywgMCwgMSk7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyc1tpXS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgRXZlbnRIYW5kbGVyLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxpc3RlbmVyc1tuYW1lXSkgdGhpcy5saXN0ZW5lcnNbbmFtZV0gPSBbXTtcclxuICAgICAgICB0aGlzLmxpc3RlbmVyc1tuYW1lXS5wdXNoKGNhbGxiYWNrKTtcclxuICAgIH07XHJcblxyXG4gICAgRXZlbnRIYW5kbGVyLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbihuYW1lKSB7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMubGlzdGVuZXJzW25hbWVdO1xyXG4gICAgfTtcclxuXHJcbiAgICBFdmVudEhhbmRsZXIucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzW25hbWVdKSB7XHJcbiAgICAgICAgICAgIHZhciBhcnJheSA9IHRoaXMubGlzdGVuZXJzW25hbWVdO1xyXG4gICAgICAgICAgICBpZiAoYXJyYXkuaW5kZXhPZihjYWxsYmFjaykgPiAtMSkgYXJyYXkuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHdpbmRvdy5FdmVudEhhbmRsZXIgPSBFdmVudEhhbmRsZXI7XHJcbn0pKCkpO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG4oZnVuY3Rpb24oKXtcclxuICAgIHZhciBDb2J3ZWIgPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0ge1xyXG4gICAgICAgICAgICBjb250YWluZXI6IHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnI2NvYndlYicsXHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjYi1jb250YWluZXInXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1lbnU6IHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NiLW1lbnUnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxvZ2dlcjoge1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY2ItbG9nZ2VyJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAob3B0aW9ucyAmJiB0eXBlb2Ygb3B0aW9ucyA9PT0gJ29iamVjdCcpXHJcbiAgICAgICAgICAgIGV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmNvbnRhaW5lci5zZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmNvbnRhaW5lci5jbGFzc05hbWUpO1xyXG5cclxuICAgICAgICB0aGlzLmV2ZW50cyA9IG5ldyBFdmVudEhhbmRsZXIoKTtcclxuICAgICAgICB0aGlzLmV2ZW50cy5vbignY29yZS5yZXNpemUnLCBmdW5jdGlvbihpbnN0YW5jZSkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5wbHVnaW5zLnN1cmZhY2UuZ2wuY2FudmFzLmhlaWdodCA9IGluc3RhbmNlLmNvbnRhaW5lci5oZWlnaHQoKTtcclxuICAgICAgICAgICAgaW5zdGFuY2UucGx1Z2lucy5zdXJmYWNlLmdsLmNhbnZhcy53aWR0aCA9IGluc3RhbmNlLmNvbnRhaW5lci53aWR0aCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIENvYndlYi5wcm90b3R5cGUucGx1Z2lucy5sb2FkKHRoaXMpO1xyXG5cclxuICAgICAgICB2YXIgc2NvcGUgPSB0aGlzO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICBzY29wZS5ldmVudHMudHJpZ2dlcignY29yZS5yZXNpemUnLCBzY29wZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGV4dGVuZChzb3VyY2UsIHByb3BlcnRpZXMpe1xyXG4gICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBwcm9wZXJ0aWVzW3Byb3BlcnR5XTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5kKHNvdXJjZVtwcm9wZXJ0eV0sIHByb3BlcnRpZXNbcHJvcGVydHldKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc291cmNlW3Byb3BlcnR5XSA9IHByb3BlcnRpZXNbcHJvcGVydHldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdpbmRvdy5Db2J3ZWIgPSBDb2J3ZWI7XHJcbn0oKSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbigoZnVuY3Rpb24gKCkge1xyXG4gICAgQ29id2ViLnByb3RvdHlwZS5wbHVnaW5zID0gbmV3IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuYXZhaWxhYmxlID0ge307XHJcblxyXG4gICAgICAgIHRoaXMuYWRkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBuYW1lLCBkZXAsIGZ1bmM7XHJcblxyXG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lID0gYXJndW1lbnRzWzBdO1xyXG4gICAgICAgICAgICAgICAgZnVuYyA9IGFyZ3VtZW50c1sxXTtcclxuICAgICAgICAgICAgICAgIGRlcCA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHRocm93IG5ldyBFcnJvcignUGFyYW1ldGVyIDE6IGV4cGVjdGVkIHN0cmluZywgZm91bmQgJyArIHR5cGVvZiBuYW1lKTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZnVuYyAhPT0gJ2Z1bmN0aW9uJykgdGhyb3cgbmV3IEVycm9yKCdQYXJhbWV0ZXIgMTogZXhwZWN0ZWQgZnVuY3Rpb24sIGZvdW5kICcgKyB0eXBlb2YgZnVuYyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lID0gYXJndW1lbnRzWzBdO1xyXG4gICAgICAgICAgICAgICAgZGVwID0gYXJndW1lbnRzWzFdO1xyXG4gICAgICAgICAgICAgICAgZnVuYyA9IGFyZ3VtZW50c1syXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKSB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciAxOiBleHBlY3RlZCBzdHJpbmcsIGZvdW5kICcgKyB0eXBlb2YgbmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRlcCAhPT0gJ2FycmF5JykgdGhyb3cgbmV3IEVycm9yKCdQYXJhbWV0ZXIgMjogZXhwZWN0ZWQgYXJyYXksIGZvdW5kICcgKyB0eXBlb2YgZGVwKTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZnVuYyAhPT0gJ2Z1bmN0aW9uJykgdGhyb3cgbmV3IEVycm9yKCdQYXJhbWV0ZXIgMzogZXhwZWN0ZWQgZnVuY3Rpb24sIGZvdW5kICcgKyB0eXBlb2YgZnVuYyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW1ldGVyczogbXVzdCBiZSAyIG9yIDMsIGZvdW5kICcgKyBhcmd1bWVudHMubGVuZ3RoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5hdmFpbGFibGVbbmFtZV0gPSB7XHJcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXM6IGRlcCxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5sb2FkID0gZnVuY3Rpb24oaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgaW5zdGFuY2UucGx1Z2lucyA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIHRoaXMuYXZhaWxhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwbHVnaW4gPSBuZXcgdGhpcy5hdmFpbGFibGVbbmFtZV0uY2FsbGJhY2soaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLmV2ZW50cy50cmlnZ2VyKCdwbHVnaW5zLmxvYWRlZCcsIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnBsdWdpbnNbbmFtZV0gPSBwbHVnaW47XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLmV2ZW50cy50cmlnZ2VyKCdwbHVnaW5zLmVycm9yJywgbmFtZSwgZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluc3RhbmNlLmV2ZW50cy50cmlnZ2VyKCdwbHVnaW5zLmxvYWRlZC5hbGwnLCBPYmplY3Qua2V5cyhpbnN0YW5jZS5wbHVnaW5zKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCkpO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG4oKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgTG9nZ2VyID0gZnVuY3Rpb24oaW5zdGFuY2UpIHtcclxuICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKGluc3RhbmNlLm9wdGlvbnMubG9nZ2VyLmNsYXNzTmFtZSk7XHJcbiAgICAgICAgaW5zdGFuY2UuY29udGFpbmVyLmFwcGVuZChjb250YWluZXIpO1xyXG5cclxuICAgICAgICB2YXIgaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpO1xyXG4gICAgICAgIGluZm8uaW5uZXJIVE1MID0gJ0xvcmVtIGlwc3VtLi4uJztcclxuICAgICAgICBpbmZvLmFkZENsYXNzKCdpbmZvJyk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChpbmZvKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbmZvID0gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICAgICAgICBpbmZvLmlubmVySFRNTCA9IHRleHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnN0YW5jZS5ldmVudHMub24oJ2xvZ2dlci5pbmZvJywgdGhpcy5pbmZvKTtcclxuICAgIH07XHJcblxyXG4gICAgQ29id2ViLnByb3RvdHlwZS5wbHVnaW5zLmFkZCgnbG9nZ2VyJywgTG9nZ2VyKTtcclxufSkoKSk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbigoZnVuY3Rpb24oKXtcclxuICAgIHZhciBNZW51ID0gZnVuY3Rpb24oaW5zdGFuY2UpIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFkZENsYXNzKGluc3RhbmNlLm9wdGlvbnMubWVudS5jbGFzc05hbWUpO1xyXG4gICAgICAgIGluc3RhbmNlLmNvbnRhaW5lci5hcHBlbmQodGhpcy5jb250YWluZXIpO1xyXG5cclxuICAgICAgICB2YXIgbWVudSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1VMJyk7XHJcbiAgICAgICAgbWVudS5hZGRDbGFzcygnbWFpbi1tZW51Jyk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKG1lbnUpO1xyXG5cclxuICAgICAgICB0aGlzLml0ZW1zID0ge1xyXG4gICAgICAgICAgICAnRmlsZSc6IHtcclxuICAgICAgICAgICAgICAgICdMb2FkLi4uJzogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2l0ZW0gY2xpY2shJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdBbGVydCEnOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmV2ZW50cy50cmlnZ2VyKCdsb2dnZXIuaW5mbycsICdMT09LIEFUIE1FISBPX08nKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuZXZlbnRzLnRyaWdnZXIoJ2xvZ2dlci5pbmZvJywgJ1NUQVBIIScpO1xyXG4gICAgICAgICAgICAgICAgfSwgMjAwMCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdIZWxwJzoge1xyXG4gICAgICAgICAgICAgICAgJ0Fib3V0IFdlYk1lc2gnOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWJvdXQgd2hhdD8hJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBmb3IodmFyIGl0ZW0gaW4gdGhpcy5pdGVtcyl7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdMSScpO1xyXG4gICAgICAgICAgICAgICAgbGkuaW5uZXJIVE1MID0gaXRlbTtcclxuICAgICAgICAgICAgICAgIGxpLmFkZENsYXNzKGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuaXRlbXNbaXRlbV07XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGkub25jbGljayA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtYWluTWVudSA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5tYWluLW1lbnUnKTtcclxuICAgICAgICAgICAgICAgIG1haW5NZW51LmFwcGVuZChsaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBDb2J3ZWIucHJvdG90eXBlLnBsdWdpbnMuYWRkKCdtZW51JywgTWVudSk7XHJcbn0pKCkpO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG4oKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBTdXJmYWNlID0gZnVuY3Rpb24oaW5zdGFuY2UpIHtcclxuICAgICAgICB0aGlzLmdsID0gR0wuY3JlYXRlKHtcclxuICAgICAgICAgICAgaGVpZ2h0OiBpbnN0YW5jZS5jb250YWluZXIuaGVpZ2h0KCksXHJcbiAgICAgICAgICAgIHdpZHRoOiBpbnN0YW5jZS5jb250YWluZXIud2lkdGgoKVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmdsLmFuaW1hdGUoKTtcclxuXHJcbiAgICAgICAgdmFyIG9ianMgPSBbXTtcclxuXHJcbiAgICAgICAgb2Jqc1swXSA9IHt9O1xyXG4gICAgICAgIG9ianNbMF0ucHJpbWl0aXZlID0gdGhpcy5nbC5UUklBTkdMRVM7XHJcbiAgICAgICAgb2Jqc1swXS5tb2RlbCA9IG1hdDQuY3JlYXRlKCk7XHJcbiAgICAgICAgb2Jqc1swXS5tZXNoID0gR0wuTWVzaC5jdWJlKCk7XHJcbiAgICAgICAgbWF0NC50cmFuc2xhdGUob2Jqc1swXS5tb2RlbCwgb2Jqc1swXS5tb2RlbCwgWy0yLCAwLCAwXSk7XHJcblxyXG4gICAgICAgIG9ianNbMV0gPSB7fTtcclxuICAgICAgICBvYmpzWzFdLnByaW1pdGl2ZSA9IHRoaXMuZ2wuVFJJQU5HTEVTO1xyXG4gICAgICAgIG9ianNbMV0ubW9kZWwgPSBtYXQ0LmNyZWF0ZSgpO1xyXG4gICAgICAgIG9ianNbMV0ubWVzaCA9IEdMLk1lc2guc3BoZXJlKCk7XHJcbiAgICAgICAgbWF0NC50cmFuc2xhdGUob2Jqc1sxXS5tb2RlbCwgb2Jqc1sxXS5tb2RlbCwgWzIsIDAsIDBdKTtcclxuXHJcbiAgICAgICAgb2Jqc1syXSA9IHt9O1xyXG4gICAgICAgIG9ianNbMl0ucHJpbWl0aXZlID0gdGhpcy5nbC5UUklBTkdMRVM7XHJcbiAgICAgICAgb2Jqc1syXS5tb2RlbCA9IG1hdDQuY3JlYXRlKCk7XHJcbiAgICAgICAgb2Jqc1syXS5tZXNoID0gR0wuTWVzaC5jeWxpbmRlcih7cmFkaXVzOjAuNX0pO1xyXG4gICAgICAgIG1hdDQudHJhbnNsYXRlKG9ianNbMl0ubW9kZWwsIG9ianNbMl0ubW9kZWwsIFswLCAwLCAtMl0pO1xyXG5cclxuICAgICAgICB2YXIgcHJvaiA9IG1hdDQuY3JlYXRlKCk7XHJcbiAgICAgICAgdmFyIHZpZXcgPSBtYXQ0LmNyZWF0ZSgpO1xyXG4gICAgICAgIHZhciBtb2RlbCA9IG1hdDQuY3JlYXRlKCk7XHJcbiAgICAgICAgdmFyIG12cCA9IG1hdDQuY3JlYXRlKCk7XHJcbiAgICAgICAgdmFyIHRlbXAgPSBtYXQ0LmNyZWF0ZSgpO1xyXG5cclxuICAgICAgICBtYXQ0LnBlcnNwZWN0aXZlKHByb2osIDQ1ICogREVHMlJBRCwgdGhpcy5nbC5jYW52YXMud2lkdGggLyB0aGlzLmdsLmNhbnZhcy5oZWlnaHQsIDAuMSwgMTAwMCk7XHJcbiAgICAgICAgbWF0NC5sb29rQXQodmlldywgWzAsNSw1XSxbMCwwLDBdLCBbMCwxLDBdKTtcclxuXHJcbiAgICAgICAgdmFyIHNoYWRlciA9IG5ldyBTaGFkZXIoXHJcbiAgICAgICAgICAgICdwcmVjaXNpb24gaGlnaHAgZmxvYXQ7XFxcclxuICAgICAgICAgICAgYXR0cmlidXRlIHZlYzMgYV92ZXJ0ZXg7XFxcclxuICAgICAgICAgICAgYXR0cmlidXRlIHZlYzMgYV9ub3JtYWw7XFxcclxuICAgICAgICAgICAgdmFyeWluZyB2ZWMzIHZfbm9ybWFsO1xcXHJcbiAgICAgICAgICAgIHVuaWZvcm0gbWF0NCB1X212cDtcXFxyXG4gICAgICAgICAgICB1bmlmb3JtIG1hdDQgdV9tb2RlbDtcXFxyXG4gICAgICAgICAgICB2b2lkIG1haW4oKSB7XFxcclxuICAgICAgICAgICAgICAgIHZfbm9ybWFsID0gKHVfbW9kZWwgKiB2ZWM0KGFfbm9ybWFsLDAuMCkpLnh5ejtcXFxyXG4gICAgICAgICAgICAgICAgZ2xfUG9zaXRpb24gPSB1X212cCAqIHZlYzQoYV92ZXJ0ZXgsMS4wKTtcXFxyXG4gICAgICAgICAgICB9JyxcclxuICAgICAgICAgICAgJ3ByZWNpc2lvbiBoaWdocCBmbG9hdDtcXFxyXG4gICAgICAgICAgICB2YXJ5aW5nIHZlYzMgdl9ub3JtYWw7XFxcclxuICAgICAgICAgICAgdW5pZm9ybSB2ZWMzIHVfbGlnaHR2ZWN0b3I7XFxcclxuICAgICAgICAgICAgdW5pZm9ybSB2ZWM0IHVfY29sb3I7XFxcclxuICAgICAgICAgICAgdm9pZCBtYWluKCkge1xcXHJcbiAgICAgICAgICAgICAgdmVjMyBOID0gbm9ybWFsaXplKHZfbm9ybWFsKTtcXFxyXG4gICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IHVfY29sb3IgKiBtYXgoMC4wLCBkb3QodV9saWdodHZlY3RvcixOKSk7XFxcclxuICAgICAgICAgICAgfSdcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICB0aGlzLmdsLmNsZWFyQ29sb3IoMC40LCAwLjQsIDAuNCwgMSk7XHJcbiAgICAgICAgdGhpcy5nbC5lbmFibGUodGhpcy5nbC5ERVBUSF9URVNUKTtcclxuXHJcbiAgICAgICAgdmFyIHVuaWZvcm1zID0ge1xyXG4gICAgICAgICAgICB1X2NvbG9yOiBbMSwgMSwgMSwgMV0sXHJcbiAgICAgICAgICAgIHVfbGlnaHR2ZWN0b3I6IHZlYzMubm9ybWFsaXplKHZlYzMuY3JlYXRlKCksWzEsIDEsIDFdKSxcclxuICAgICAgICAgICAgdV9tb2RlbDogbW9kZWwsXHJcbiAgICAgICAgICAgIHVfbXZwOiBtdnBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2NvcGUgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZ2wub25kcmF3ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHNjb3BlLmdsLmNsZWFyKHNjb3BlLmdsLkNPTE9SX0JVRkZFUl9CSVQgfCBzY29wZS5nbC5ERVBUSF9CVUZGRVJfQklUKTtcclxuXHJcbiAgICAgICAgICAgIG9ianMuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcclxuICAgIFx0XHRcdG1hdDQubXVsdGlwbHkodGVtcCwgdmlldywgaXRlbS5tb2RlbCk7XHJcbiAgICBcdFx0XHRtYXQ0Lm11bHRpcGx5KG12cCwgcHJvaiwgdGVtcCk7XHJcblxyXG4gICAgXHRcdFx0dW5pZm9ybXMudV9tb2RlbCA9IGl0ZW0ubW9kZWw7XHJcbiAgICBcdFx0XHRzaGFkZXIudW5pZm9ybXModW5pZm9ybXMpLmRyYXcoaXRlbS5tZXNoLCBpdGVtLnByaW1pdGl2ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuZ2wub251cGRhdGUgPSBmdW5jdGlvbihkdCkge1xyXG4gICAgICAgICAgICBvYmpzLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICBtYXQ0LnJvdGF0ZVkoaXRlbS5tb2RlbCwgaXRlbS5tb2RlbCwgZHQgKiAwLjIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpbnN0YW5jZS5jb250YWluZXIuYXBwZW5kKHRoaXMuZ2wuY2FudmFzKTtcclxuICAgIH07XHJcblxyXG4gICAgQ29id2ViLnByb3RvdHlwZS5wbHVnaW5zLmFkZCgnc3VyZmFjZScsIFN1cmZhY2UpO1xyXG59KSgpKTtcclxuIl19
