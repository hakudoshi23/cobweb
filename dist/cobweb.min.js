!function(){"use strict";function e(e){e=Object.assign({},o,e);var t=new XMLHttpRequest;if(t.onreadystatechange=function(){4==this.readyState&&(200==this.status?e.success&&e.success(this.response):e.error&&error.success(this.response))},"GET"===e.method){var n=i(e.data),r=e.url+(n?"?"+n:"");t.open(e.method,r,e.async),t.send()}else"POST"===e.method&&(t.open(e.method,e.url,e.async),t.send(e.data));return t}function t(e,t,n){return n||(n=t,t=null),Ajax.ajax({url:e,data:t,success:n,method:"GET"})}function n(e,t,n){return n||(n=t,t=null),Ajax.ajax({url:e,data:t,success:function(e){n(JSON.parse(e))},method:"GET"})}function r(e,t,n){return n||(n=t,t=null),Ajax.ajax({url:e,data:t,success:n,method:"POST"})}function i(e){var t="";for(var n in e){var r=n+"="+encodeURIComponent(e[n]);t+="&"+r}return t.slice(1)}var o={method:"GET",url:"",data:{},async:!0,success:null,error:null};window.Ajax={ajax:e,get:t,getJSON:n,post:r}}(),function(){"use strict";function e(e,t,n){e[t]||(e[t]=n)}e(Array.prototype,"unique",function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e}),e(Array.prototype,"forEach",function(e){for(var t=0;t<this.length;t++)e(this[t],t,this)})}(),function(){"use strict";function e(e,t,n){e[t]||(e[t]=n)}function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}e(HTMLElement.prototype,"addClass",function(){var e,t;for(var n in arguments)e=this.className?this.className.trim().replace(/\s+/g," ").split(" "):[],t=arguments[n]?arguments[n].trim().replace(/\s+/g," ").split(" "):[],this.className=e.concat(t).unique().join(" ")}),e(HTMLElement.prototype,"hasClass",function(){var e,t=this.className?this.className.trim().replace(/\s+/g," ").split(" "):[];for(var n in arguments){e=arguments[n]?arguments[n].trim().replace(/\s+/g," ").split(" "):[];for(var r=0;r<e.length;r++){var i=e[r];if(t.indexOf(i)==-1)return!1}}return!0}),e(HTMLElement.prototype,"removeClass",function(){var e,t,n=0,r=function(t){n=e.indexOf(t),n!=-1&&e.splice(n,1)};for(var i in arguments)e=this.className?this.className.trim().replace(/\s+/g," ").split(" "):[],t=arguments[i]?arguments[i].trim().replace(/\s+/g," ").split(" "):[],t.forEach(r),this.className=e.unique().join(" ")}),e(HTMLElement.prototype,"data",function(e,t){window.__data_cache||(window.__data_cache=new WeakMap);var n=window.__data_cache.get(this)||{};return void 0===t?e?n&&n[e]:n:(n[e]=t,window.__data_cache.set(this,n),this)}),e(HTMLElement.prototype,"setData",function(e){return window.__data_cache||(window.__data_cache=new WeakMap),window.__data_cache.set(this,e),this}),e(HTMLElement.prototype,"attr",function(e,t){if(void 0!==t)this.setAttribute(e,t);else{if(null!==t)return this.getAttribute(e);this.removeAttribute(e)}return this}),e(HTMLElement.prototype,"attrData",function(e,t){return this.attr("data-"+e,t)}),e(Element.prototype,"matches",Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1}),e(HTMLElement.prototype,"parent",function(e){if(!e)return this.parentElement;for(var t=this.parentElement;!t.matches(e);)t=t.parentElement;return t}),e(HTMLElement.prototype,"height",function(){if(1!=arguments.length)return this.clientHeight;var e=arguments[0];"number"==typeof e?this.style.height=e+"px":this.style.height=e}),e(HTMLElement.prototype,"width",function(){if(1!=arguments.length)return this.clientWidth;var e=arguments[0];"number"==typeof e?this.style.width=e+"px":this.style.width=e}),e(window,"guid",function(){return"GUID-"+t()+"-"+t()+"-"+t()}),e(HTMLElement.prototype,"guid",function(){var e=null,t=null;do e=window.guid(),t=document.querySelector("#"+e);while(t);return this.attr("id",e),e})}(),function(){"use strict";function e(e,t,n){e[t]||(e[t]=n)}e(Object,"clone",function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];"object"==typeof r?t[n]=Object.clone(e[n]):t[n]=e[n]}return t}),e(Object,"assign",function(e,t){if(null===e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=Object.prototype.hasOwnProperty,i=1;i<arguments.length;i++){var o=arguments[i];if(null!==o)for(var a in o)r.call(o,a)&&(n[a]=o[a])}return n}),e(Object,"extend",function(e,t){return Object.assign({},t,e)})}(),function(){"use strict";var e=function(e,t){this.parent=e||null,this.data=t||{},this.children=[]};window.TreeNode=e,e.prototype.isRoot=function(){return!this.parent},e.prototype.add=function(e){var t=new this.constructor(this,e);return this.children.push(t),t},e.prototype.remove=function(e){return this.children.slice(e,1),this},e.prototype.dfs=function(e){for(var t=[],n=0;n<this.children.length;n++)(!e||e&&e(this.children[n]))&&t.push(this.children[n]),t.concat(this.children[n].dfs(e));return t},e.prototype.bfs=function(e){var t,n=[];for(t=0;t<this.children.length;t++)(!e||e&&e(this.children[t]))&&n.push(this.children[t]);for(t=0;t<this.children.length;t++)n.concat(this.children[t].bfs(e));return n},e.extend=function(){var t=function(t,n){e.call(this,t,n)};return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,new t}}(),function(){"use strict";var e=function(e){this.isDebug=!!e,this.listeners={}};e.prototype.trigger=function(){var e=arguments[0],t=this.listeners[e]||[];Array.prototype.splice.call(arguments,0,1),this.isDebug&&console.debug(e,arguments);for(var n=0;n<t.length;n++)t[n].apply(null,arguments)},e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e){delete this.listeners[e]},e.prototype.off=function(e,t){if(this.listeners[e]){var n=this.listeners[e];n.indexOf(t)>-1&&n.splice(index,1)}},e.prototype.reset=function(){var e=this;Object.keys(this.listeners).forEach(function(t){delete e.listeners[t]})},window.EventHandler=e}(),function(){"use strict";var e=function(t){this.handlers=[],this.addHandler(this.level.ALL,function(t,n){e.prototype.level.DEBUG===t?console.debug.apply(this,n):e.prototype.level.INFO===t?console.info.apply(this,n):e.prototype.level.WARNING===t?console.warn.apply(this,n):e.prototype.level.ERROR===t&&console.error.apply(this,n)})};e.prototype.debug=function(){this.log(e.prototype.level.DEBUG,arguments)},e.prototype.info=function(){this.log(e.prototype.level.INFO,arguments)},e.prototype.warning=function(){this.log(e.prototype.level.WARNING,arguments)},e.prototype.error=function(){this.log(e.prototype.level.ERROR,arguments)},e.prototype.log=function(e,t){for(var n=e,r=this.handlers[n]||[];n>=0;)r.forEach(function(n){n(e,t)}),r=this.handlers[--n]||[]},e.prototype.addHandler=function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},e.prototype.removeHandler=function(e,t){var n=this.handlers[e];if(n){var r=n.indexOf(t);r>-1&&n.splice(r,1)}},e.prototype.level={ALL:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4,NONE:5},window.Logger=e}(),function(){"use strict";var e={container:{selector:"#cobweb"}},t=function(t){this.options=Object.assign({},e,t);var n=this;if(this.container=document.querySelector(this.options.container.selector),!this.container)throw new Error("Invalid container selector: '"+this.options.container.selector+"'");this.container.addClass("cb-container"),this.container.data("instance",this),this.logger=new Logger(this,!0),this.events=new EventHandler(!0),this.modules=new Modules([this],{onLoadedAll:function(e){n.events.trigger("modules.loaded.all",e),n.events.trigger("app.loaded")}})};window.Cobweb=t}(),function(){"use strict";function e(e){var r=[],i=null,o=0;for(var a in e)for(i=e[a],o=0;o<i.dependencies.length;o++){var s=i.dependencies[o];if(!e[s])throw new Error("Missing module: "+s)}for(var c=null,u=t(e);u.length>0;)if(c=u.splice(0,1)[0],i=e[c])for(r.push(c),o=0;o<i.dependant.length;o++){var h=i.dependant[o];n(r,e[h])&&u.push(h)}if(Object.keys(e).length!==r.length)throw new Error("Dependency cycle!");return r}function t(e){var t=[];for(var n in e)0===e[n].dependencies.length&&t.push(n);return t}function n(e,t){for(var n=0;n<t.dependencies.length;n++)if(e.indexOf(t.dependencies[n])===-1)return!1;return!0}function r(e,t,n){var r=e[t],i="function"==typeof r;i&&r.apply(null,n)}var i=function(t,n){n=n||{};var o=i.prototype.all;try{for(var a=e(o),s=0;s<a.length;s++){var c=a[s],u=o[c];try{u.init.apply(this,t),r(n,"onLoaded",[c,u])}catch(e){console.error("Error loading module:",c,e),r(n,"onError",[e,c,u])}}r(n,"onLoadedAll",[a])}catch(e){console.error("Error loading modules:",e)}};i.prototype.all={},i.prototype.add=function(e,t,n){n=n||[];var r,i,o=[];for(var a in this.all){var s=this.all[a];for(i=0;i<s.dependencies.length;i++)s.dependencies[i]===e&&o.push(a)}for(i=0;i<n.length;i++)r=this.all[n[i]],r&&r.dependant.push(e);this.all[e]={dependencies:n,dependant:o,init:t}},window.Modules=i}(),function(){"use strict";Modules.prototype.add("shader",function(e){e.asset=e.asset||{},e.asset.shader={get:function(e,t){var n=null,r=null;Ajax.get("shader/"+e+".vert",function(e){r&&(n=new Shader(e,r),t(n)),r=e}),Ajax.get("shader/"+e+".frag",function(e){r&&(n=new Shader(r,e),t(n)),r=e})}}},["surface-interaction"])}(),function(){"use strict";var e=function(e,t,n){this.center=e||[0,0,0],this.rotation=t||[-.5,-.5],this.distance=n||12,this.projection=mat4.create()};e.prototype.getViewMatrix=function(e){e=e||mat4.create();var t=[0,0,0];return this.getPosition(t),mat4.lookAt(e,t,this.center,this.getUpDirection()),e},e.prototype.getPosition=function(e){return e=e||vec3.create(),vec3.set(e,0,0,-this.distance),vec3.rotateX(e,e,this.rotation[1]),vec3.rotateY(e,e,-this.rotation[0]),e},e.prototype.getDirection=function(e){e=e||vec3.create();var t=this.getPosition();return vec3.sub(e,this.center,t),vec3.normalize(e,e),e},e.prototype.getRay=function(e,t,n){e=e||new Math.Ray,this.getPosition(e.start),vec3.set(e.direction,t[0]/(.5*n[0])-1,t[1]/(.5*n[1])-1,1);var r=mat4.create();return mat4.multiply(r,this.projection,this.getViewMatrix()),mat4.invert(r,r),vec3.transformMat4(e.direction,e.direction,r),vec3.normalize(e.direction,e.direction),e},e.prototype.getUpDirection=function(e){e=e||vec3.create();var t=this.rotation[1];return t>=Math.PI/2&&t<=3*Math.PI/2?vec3.set(e,0,-1,0):vec3.set(e,0,1,0),e},window.Math.Camera=e}(),function(){"use strict";function e(e,t){for(var n=0;n<3;n++){if(e[n]<t.min[n])return!1;if(e[n]>t.max[n])return!1}return!0}function t(e,t){for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<3;i++)r[i]<t.min[i]&&(t.min[i]=r[i]),r[i]>t.max[i]&&(t.max[i]=r[i])}var n={maxItems:5,maxDepth:5},r=function(e,t){for(this.items=[],this.children=null,this.depth=t||0,this.parent=e||null,this.aabb={max:[0,0,0],min:[0,0,0]},this.root=this;null!==this.root.parent;)this.root=this.root.parent};r.prototype.getAllItems=function(){if(this.children){for(var e=[],t=0;t<this.children.length;t++)e=e.concat(this.children[t].getAllItems());return e}return this.items},r.prototype.addItems=function(e){for(var t=!1,n=0;n<e.length;n++){var r=e[n];t|=this.addItem(r)}return t},r.prototype.addItem=function(e){if(this.contains(e)){if(!this.children)return this.items.push(e),this.splitIfNeeded(),!0;for(var t=0;t<8;t++)if(this.children[t].addItem(e))return!0}return!1},r.prototype.splitIfNeeded=function(){if(this.root.options.maxItems<this.items.length&&this.root.options.maxDepth>=this.depth){this.children=[];for(var e=0;e<8;e++)this.children[e]=new r(this,this.depth+1),this.children[e].updateDimensions(this.aabb,e);for(;this.items.length>0;){var t=this.items.pop();for(e=0;e<8;e++){var n=this.children[e];if(n.addItem(t))break}}}},r.prototype.removeItem=function(e){var t=this.items.indexOf(e);return t>-1&&(this.items.splice(t,1),this.mergeIfNeeded(),!0)},r.prototype.mergeIfNeeded=function(){},r.prototype.contains=function(t){return e(t,this.aabb)},r.prototype.getCollidingNodes=function(e){var t=[],n=(this.aabb,[0,0,0]);if(Math.geo.rayAABBCollision(e.start,e.direction,this.aabb.min,this.aabb.max,n))if(this.children)for(var r=0;r<this.children.length;r++){var i=this.children[r];t=t.concat(i.getCollidingNodes(e))}else t.push(this);return t},r.prototype.getCollidingItems=function(e){var t=[];return this.getCollidingNodes(e).forEach(function(e){t=t.concat(e.items)}),t},r.prototype.updateDimensions=function(e,t){var n=[.5*(e.max[0]-e.min[0]),.5*(e.max[1]-e.min[1]),.5*(e.max[2]-e.min[2])],r=[!(1&t),!(2&t),!(4&t)];this.aabb.min=[e.min[0]+n[0]*r[0],e.min[1]+n[1]*r[1],e.min[2]+n[2]*r[2]],this.aabb.max=[this.aabb.min[0]+n[0],this.aabb.min[1]+n[1],this.aabb.min[2]+n[2]]};var i=function(e){this.options=Object.assign({},n,e),r.call(this)};i.prototype=Object.create(r.prototype),i.prototype.constructor=r;var o=i.prototype.addItems;i.prototype.addItems=function(e){this.growIfNeeded(e),o.call(this,e)},i.prototype.updateDimensions=function(e){var t=this.getAllItems();if(e&&t.push(e),this.shrinkIfNeeded(t),this.growIfNeeded(t),this.children)for(var n=0;n<this.children.length;n++)this.children[n].updateDimensions(this.aabb,n)},i.prototype.shrinkIfNeeded=function(e){console.debug("shrinkIfNeeded")},i.prototype.growIfNeeded=function(e){t(e,this.aabb)},Math.Octree=i}(),function(){"use strict";var e=function(e,t){this.normal=t||[0,1,0],this.point=e||vec3.create(),vec3.normalize(this.normal,this.normal)};window.Math.Plane=e}(),function(){"use strict";var e=function(e,t){this.direction=t||[0,0,1],this.start=e||vec3.create(),vec3.normalize(this.direction,this.direction)};e.fromPoints=function(t,n){var r=vec3.create();return vec3.sub(r,n,t),new e(t,r)},window.Math.Ray=e}(),function(){"use strict";function e(e,n){var r=t();e.appendChild(r)}function t(){var e=document.createElement("div");return e.className="pane-header",e}Modules.prototype.add("pane-header",function(t){t.events.on("pane.create",function(n){e(n,t)})},["pane-types"])}(),function(){"use strict";Modules.prototype.add("pane-types",function(e){e.events.on("pane.split",function(t,n){var r=t.attrData("pane-type");r&&e.pane.setType(n,r)}),e.pane.types={},e.pane.setType=function(t,n){if(this.types[n]){var r=this.types[n];r.onPaneType(t,e);var i=t.querySelector(".pane-header");r.onCreateHeader(i,e),t.dataset.paneType=n}}},["pane"])}(),function(){"use strict";Modules.prototype.add("pane",function(e){function t(t){e.events.trigger("pane.create",t)}function n(t,n){e.events.trigger("pane.split",t,n)}function r(t){e.events.trigger("pane.resize",t)}e.events.on("app.loaded",function(){e.pane.internal=new Pane({container:e.options.container.selector,separator:{size:3},callbacks:{onPaneCreate:t,onPaneSplit:n,onPaneResize:r}});var i=e.pane.internal.container.querySelector(".pane");e.pane.setType(i,"surface")}),e.pane={}})}(),function(){"use strict";function e(e,t,r,i){var o=n(e,t),a=n(e,r),s=n(e,i),c=vec3.dot(o,o),u=vec3.dot(o,a),h=vec3.dot(a,a),l=vec3.dot(s,o),d=vec3.dot(s,a),f=c*h-u*u,p=[(h*l-u*d)/f,(c*d-u*l)/f,0];return p[2]=1-p[0]-p[1],p}function t(e,t,n){var r=vec3.create(),i=vec3.create();return vec3.sub(r,t,e),vec3.sub(i,n,e),vec3.cross(r,r,i),r}function n(e,t){var n=vec3.create();return vec3.sub(n,t,e),n}var r=1e-6;Math.geo=Math.geo||{},Math.geo.rayTriangleCollision=function(n,r,i,o,a,s){s=s||[0,0,0];var c=t(i,o,a);if(Math.geo.rayPlaneCollision(n,r,i,c,s)){var u=e(i,o,a,s);return u[0]<=1&&u[0]>=0&&u[1]<=1&&u[1]>=0&&u[2]<=1&&u[2]>=0}return!1},Math.geo.rayPlaneCollision=function(e,t,n,i,o){var a=vec3.dot(n,i)-vec3.dot(i,e),s=vec3.dot(i,t);if(Math.abs(s)<r)return!1;var c=a/s;return!(c<0)&&(o&&(vec3.scale(o,t,c),vec3.add(o,e,o)),!0)},Math.geo.rayAABBCollision=function(e,t,n,r,i){i=i||vec3.create();var o,a=!0,s=new Float32Array(3),c=0,u=new Float32Array(3),h=new Float32Array(3);for(c=0;c<3;++c)e[c]<n[c]?(s[c]=1,h[c]=n[c],a=!1):e[c]>r[c]?(s[c]=0,h[c]=r[c],a=!1):s[c]=2;if(a)return vec3.copy(i,e),!0;for(c=0;c<3;++c)2!==s[c]&&0!==t[c]?u[c]=(h[c]-e[c])/t[c]:u[c]=-1;for(o=0,c=1;c<3;c++)u[o]<u[c]&&(o=c);if(u[o]<0)return!1;if(u[o]>Number.MAX_VALUE)return!1;for(c=0;c<3;++c)if(o!=c){if(i[c]=e[c]+u[o]*t[c],i[c]<n[c]||i[c]>r[c])return!1}else i[c]=h[c];return!0},Math.geo.rayPointDistance=function(e,t){var n=[0,0,0];return vec3.sub(n,t,e.start),vec3.cross(n,e.direction,n),vec3.len(n)}}(),function(){"use strict";Modules.prototype.add("math-halfEdge-cube",function(e){function t(){var e=new Math.HalfEdgeMesh,t=[];t[0]=[-1,-1,1],t[1]=[1,-1,1],t[2]=[1,1,1],t[3]=[-1,1,1],t[4]=[-1,-1,-1],t[5]=[1,-1,-1],t[6]=[1,1,-1],t[7]=[-1,1,-1],e.addVertices(t);var n=[];return n.push(t[0]),n.push(t[1]),n.push(t[2]),n.push(t[3]),e.addFace(n),n=[],n.push(t[7]),n.push(t[6]),n.push(t[5]),n.push(t[4]),e.addFace(n),n=[],n.push(t[1]),n.push(t[0]),n.push(t[4]),n.push(t[5]),e.addFace(n),n=[],n.push(t[2]),n.push(t[1]),n.push(t[5]),n.push(t[6]),e.addFace(n),n=[],n.push(t[3]),n.push(t[2]),n.push(t[6]),n.push(t[7]),e.addFace(n),n=[],n.push(t[0]),n.push(t[3]),n.push(t[7]),n.push(t[4]),e.addFace(n),e}Math.HalfEdgeCube=t},["math-halfEdge"])}(),function(){"use strict";function e(e,n,r){var i={};return i.vertex=n,i.face=r?r:new a(i),i.opposite=t(e,n)||i,i.next=null,e._halfEdge.outEdges.push(i),i}function t(e,t){var n=t._halfEdge.outEdges.filter(function(t){return t.vertex===e});return n&&n[0]?n[0]:null}function n(){return this.outEdges.map(function(e){return e.face})}function r(){var e=[0,0,0];return this.getFaces().forEach(function(t){vec3.add(e,e,t.computeRawNormal())}),vec3.normalize(e,e),e}function i(e,t,n){var r=vec3.create(),i=vec3.create();return vec3.sub(r,t,e),vec3.sub(i,n,e),vec3.cross(r,r,i),r}Modules.prototype.add("math-halfEdge",function(e){Math.HalfEdgeMesh=o});var o=function(){this.halfEdges=[],this.vertices=[],this.faces=[],this.bounds=new Math.Octree,this.bump()};o.prototype.bump=function(){this.lastBump=Date.now()},o.prototype.addVertices=function(e){if(arguments.length>1&&this.addVertices.apply(this,arguments),Array.isArray(e)){this.bounds.addItems(e);for(var t=0;t<e.length;t++){var i=e[t],o=this.vertices.indexOf(i);if(o<0){var a={};a.computeNormal=r,a.ownIndex=this.vertices.length,a.getFaces=n,a.outEdges=[],i._halfEdge=a,this.vertices.push(i)}else console.error("addVertices: Adding vertex twice!",i)}}},o.prototype.addFace=function(t){if(arguments.length>1&&this.addFace.apply(this,arguments),Array.isArray(t))if(t.length>=3){var n=e(t[0],t[1]),r=e(t[1],t[2],n.face);if(n.next=r,this.halfEdges.push(n,r),t.length>3){for(var i,o=r,a=2;a<t.length-1;a++)i=e(t[a],t[a+1],n.face),r.next||(r.next=i),i.next=o,this.halfEdges.push(i),o=i;i=e(t[a],t[0],n.face),i.next=n,this.halfEdges.push(i),o.next=i}this.faces.push(n.face)}else console.error("addFace: 3 or more vertices needed to form a face!")},o.prototype.onVertexChange=function(e){if(arguments.length>1&&this.onVertexChange.apply(this,arguments),null!==this.mesh)for(var t=0;t<e.length;t++){var n=e[t],r=this.mesh.vertexBuffers.vertices.data;r[3*n._halfEdge.ownIndex+0]=n[0],r[3*n._halfEdge.ownIndex+1]=n[1],r[3*n._halfEdge.ownIndex+2]=n[2]}},o.prototype.onVertexChangeIndex=function(e){arguments.length>1&&this.onVertexChangeIndex.apply(this,arguments);var t=this.vertices;this.onVertexChange(e.map(function(e){return t[e]}))},o.prototype.clear=function(){this.halfEdges=[],this.vertices=[],this.faces=[]},o.prototype.getFaces=function(e,t){var n=[],r=[],i=this.bounds.getCollidingItems(e);return i.forEach(function(e){e._halfEdge.getFaces().forEach(function(e){n.indexOf(e)===-1&&n.push(e)})}),n.forEach(function(n){for(var i=n.getVerticesTriangulated(),o=0;o<i.length;o++){var a=i[o],s=[0,0,0];if(Math.geo.rayTriangleCollision(e.start,e.direction,a[0],a[1],a[2],s)){r.push(n),t.push(s);break}}}),r},o.prototype.getFace=function(e,t){var n=[],r=this.getFaces(e,n);if(0===r.length)return null;var i=0,o=Number.MAX_VALUE;return r.forEach(function(t,n){var r=vec3.dist(t.computeCenter(),e.start);r<o&&(o=r,i=n)}),vec3.copy(t,n[i]),r[i]};var a=function(e){this.halfEdge=e};a.prototype.getEdges=function(){for(var e=[],t=this.halfEdge;t.next!==this.halfEdge;)e.push(t),t=t.next;return e.push(t),e},a.prototype.getVertices=function(){return this.getEdges().map(function(e){return e.vertex})},a.prototype.getVerticesTriangulated=function(){for(var e=[],t=this.getVertices(),n=0;n<t.length-2;n++)e.push([t[0],t[n+1],t[n+2]]);return e},a.prototype.computeRawNormal=function(){var e=[0,0,0];return this.getVerticesTriangulated().forEach(function(t){var n=i(t[0],t[1],t[2]);vec3.add(e,e,n)}),e},a.prototype.computeNormal=function(){var e=this.computeRawNormal();return vec3.normalize(e,e),e},a.prototype.computeCenter=function(){var e=this.getVertices(),t=e.reduce(function(e,t,n){return vec3.add(e,e,t),e},[0,0,0]);return vec3.scale(t,t,1/e.length),t}}(),function(){"use strict";function e(e,t){var i=document.createElement("canvas");i.id="surface"+r++,i.className="surface",e.appendChild(i),t.surface.map=t.surface.map||{},t.surface.map[i.id]={camera:new Math.Camera},n(t,e),t.events.trigger("surface.create",i)}function t(e,t){var n=document.createElement("label");n.innerHTML="Surface Pane",e.appendChild(n)}function n(e,t){var n=t.querySelector("canvas"),r=n.getContext("2d"),i=e.surface.map[n.id],o=t.querySelector(".pane-header"),a=o?o.height():0,s=t.width(),c=t.height()-a;i.imgData=r.createImageData(s,c),i.buffer=new Uint8Array(s*c*4),n.height=c,n.width=s,mat4.perspective(i.camera.projection,45*DEG2RAD,s/c,.1,1e3)}Modules.prototype.add("surface",function(r){r.pane.types.surface={onPaneType:e,onCreateHeader:t},r.events.on("pane.resize",function(e){"surface"===e.attrData("pane-type")&&n(r,e)}),window.addEventListener("resize",function(e){for(var t=r.pane.internal.container.querySelectorAll(".pane canvas"),i=0;i<t.length;i++)n(r,t[i].parentNode)}),r.surface={}},["pane-types"]);var r=0}(),function(){"use strict";function e(e,t,r){if(t){o||(r[0]=-r[0]);var i=e.rotation;i[0]=t[0]+.005*r[0],i[1]=t[1]+.005*r[1],n(i)}}function t(e,t){return e?[e[0]-t[0],e[1]-t[1]]:[0,0]}function n(e){var t=2*Math.PI;e[0]<0&&(e[0]=t+e[0]),e[0]>=t&&(e[0]=e[0]-t),e[1]<0&&(e[1]=t+e[1]),e[1]>=t&&(e[1]=e[1]-t)}var r=null,i=null;Modules.prototype.add("common-interaction",function(n){n.surface.interactions.common={onMouseWheel:function(e,t){var r=e.target,i=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));i/=2;var o=n.surface.map[r.id];return o.camera.distance-=i,o.camera.distance=Math.max(o.camera.distance,0),!0},onMouseMove:function(o,a){if(o.target.dataset.moving){var s=o.target,c=n.surface.map[s.id];if(c){var u=t(i,a);e(c.camera,r,u)}}return!1},onMouseDown:function(e,t){var a=e.target,s=n.surface.map[a.id];return 3!==e.which||(e.target.dataset.moving="true",o=vec3.equals(s.camera.getUpDirection(),[0,1,0]),r=s.camera.rotation.slice(),i=t,!1)},onMouseUp:function(e,t){if(3===e.which){delete e.target.dataset.moving;n.surface.map[e.target.id];i=null}return!0},onClick:function(e,t){return!0},onRender:function(e){}}},["surface-interaction"]);var o=!0}(),function(){"use strict";function e(e){return e._cache=e._cache||{},e._cache[n]?e._cache[n].time<=e.lastBump&&(e._cache[n]=t(e),e._cache[n].time=Date.now()):(e._cache[n]=t(e),e._cache[n].time=Date.now()),e._cache[n]}function t(e){var t={},n=[],r=[];return e.faces.forEach(function(e){for(var t=e.getVertices(),i=0;i<t.length;i++){var o=t[i+1>=t.length?0:i+1],a=t[i];n.push(a[0],a[1],a[2]),r.push(0,0,0,1),n.push(o[0],o[1],o[2]),r.push(0,0,0,1)}}),t.vertices=new Float32Array(n),t.colors=new Float32Array(r),GL.Mesh.load(t)}Modules.prototype.add("edit-interaction-render",function(t){var n=null;t.asset.shader.get("wireframe",function(e){n=e});var r={u_mvp:mat4.create()},i=mat4.create();t.surface.interactions.edit.onRender=function(o){t.scene.getObjects().forEach(function(a){var s=a.data;if(o.camera.getViewMatrix(i),mat4.multiply(i,o.camera.projection,i),mat4.multiply(r.u_mvp,i,s.model),n&&(n.uniforms(r),s.mesh instanceof Math.HalfEdgeMesh)){var c=e(s.mesh);n.draw(c,t.graphics.gl.LINES)}})}},["edit-interaction","shader"]);var n="edit-interaction-render"}(),function(){"use strict";function e(e,n,r){t(e,n,r,"vertices")}function t(e,t,r,i){n(e,t);var o=e.objects[t.name][i],a=o.indexOf(r);a>=0?o.splice(a,1):o.push(r)}function n(e,t){var n=t.name;e.objects[n]||(e.objects[n]={faces:[],edges:[],vertices:[]})}function r(e){var t=[];return e.forEach(function(e){e._halfEdges.outEdges.forEach(function(e){t.indexOf(e)!=-1&&t.push(e)})}),t}Modules.prototype.add("edit-interaction-selection",function(t){t.surface.interactions.edit.selection={objects:{},add:function(t,n){var i=this,o=n.mesh.bounds.getCollidingItems(t);o.forEach(function(r){Math.geo.rayPointDistance(t,r)<=.2&&e(i,n,r)});var a=r(o);a.forEach(function(e){})},clear:function(){this.objects={}},isEmpty:function(){return!0}}},["edit-interaction"])}(),function(){"use strict";var e=!1,t=[0,0,0];Modules.prototype.add("edit-interaction",function(n){n.surface.interactions.edit={onMouseWheel:function(e,t){return!0},onMouseMove:function(r,i){if(e&&!this.selection.isEmpty()){var o=r.target,a=n.surface.map[o.id],s=this.selection.objects[0],c=a.camera.getRay(null,i,[o.width,o.height]),u=a.camera.getDirection(),h=this.selection.faces[0],l=[0,0,0];if(Math.geo.rayPlaneCollision(c.start,c.direction,t,u,l)){var d=[0,0,0];vec3.sub(d,l,t),h.getVertices().forEach(function(e){vec3.add(e,e.originalPosition,d),s.bounds.updateDimensions(),s.bump()})}}return!0},onMouseDown:function(t,r){var i=t.target,o=n.surface.map[i.id];if(1===t.which){e=!0;var a=o.camera.getRay(null,r,[i.width,i.height]),s=this.selection;return n.scene.getObjects().forEach(function(e){s.add(a,e.data)}),!1}return!0},onMouseUp:function(t,n){return e=!1,!0},onClick:function(e,t){return!0}},n.events.on("surface.create",function(e){n.surface.setInteraction(e,"edit")})},["surface-interaction"])}(),function(){"use strict";Modules.prototype.add("object-interaction",function(e){e.surface.interactions.object={onMouseWheel:function(e,t){return!0},onMouseMove:function(e,t){return!0},onMouseDown:function(t,n){var r=t.target,i=e.surface.map[r.id];if(1===t.which){var o=i.camera.getRay(null,n,[r.width,r.height]),a=!1,s=vec3.create();return e.scene.getObjects().forEach(function(e){a=geo.testRayBBox(o.start,o.direction,e.data.mesh.bounding,e.data.model,s),a?e.data.selected=!0:delete e.data.selected}),!1}return!0},onMouseUp:function(e,t){return!0},onClick:function(e,t){return!0},onRender:function(e){}}},["surface-interaction"])}(),function(){"use strict";function e(e,n){var r=t(n);switch(n.type){case"mousewheel":return e.onMouseWheel(n,r);case"mousemove":return e.onMouseMove(n,r);case"mousedown":return e.onMouseDown(n,r);case"mouseup":return e.onMouseUp(n,r);case"click":return e.onClick(n,r)}}function t(e){return[e.layerX,e.layerY]}Modules.prototype.add("surface-interaction",function(t){function n(n){var r=t.surface.getInteractionCallbacks(n.target),i=e(r,n);if(i){var o=t.surface.interactions.common;e(o,n)}}function r(e){return e.preventDefault(),!1}t.surface.interactions={},t.surface.setInteraction=function(e,t){e.dataset.interaction=t},t.surface.getInteractionCallbacks=function(e){var n=e.dataset.interaction;return t.surface.interactions[n]},t.surface.onRender=function(e,n){var r=!0,i=t.surface.getInteractionCallbacks(e);if(i.onRender&&(r=i.onRender(n)),r){var o=t.surface.interactions.common;o.onRender(n)}},t.events.on("surface.create",function(e){e.oncontextmenu=r,e.onmousewheel=n,e.onmousemove=n,e.onmousedown=n,e.onmouseup=n,e.onclick=n}),t.events.on("pane.split",function(e,t){var n=e.dataset.interaction;t.dataset.interaction=n})},["surface"])}(),function(){"use strict";function e(e,n,o){if(e.camera.getViewMatrix(i),mat4.multiply(i,e.camera.projection,i),mat4.multiply(r.u_mvp,i,n.model),r.u_model=n.model,o)if(o.uniforms(r),n.mesh instanceof Math.HalfEdgeMesh){var a=t(n.mesh);o.draw(a,n.primitive)}else o.draw(n.mesh,n.primitive)}function t(e){return e._cache=e._cache||{},e._cache[o]?e._cache[o].time<=e.lastBump&&(e._cache[o]=n(e),e._cache[o].time=Date.now()):(e._cache[o]=n(e),e._cache[o].time=Date.now()),e._cache[o]}function n(e){var t={},n=[],r=[];return e.faces.forEach(function(e){var t=e.computeNormal();e.getVerticesTriangulated().forEach(function(e){e.forEach(function(e){n.push(e[0],e[1],e[2]),r.push(t[0],t[1],t[2])})})}),t.vertices=new Float32Array(n),t.normals=new Float32Array(r),GL.Mesh.load(t)}Modules.prototype.add("render-solid",function(t){var n=null;t.asset.shader.get("solid",function(e){n=e});var i={type:"object",primitive:t.graphics.gl.LINES,mesh:GL.Mesh.grid({lines:11,size:10}),model:mat4.create()};t.surface.renders.solid=function(o){var a=vec3.create();o.camera.getPosition(a),vec3.add(a,a,[1,2,0]),vec3.normalize(a,a),r.u_lightvector=a,e(o,i,n),t.scene.getObjects().forEach(function(t){e(o,t.data,n)})},t.events.on("surface.create",function(e){t.surface.setRender(e,"solid")})},["surface-render","shader"]);var r={u_color:[.7,.7,.7,1],u_lightvector:null,u_model:null,u_mvp:mat4.create()},i=mat4.create(),o="render-solid"}(),function(){"use strict";Modules.prototype.add("surface-render",function(e){e.surface.renders={},e.surface.setRender=function(e,t){e.dataset.render=t},e.surface.getRender=function(t){var n=t.dataset.render;return e.surface.renders[n]};for(var t=document.querySelectorAll(".pane"),n=0;n<t.length;n++)if("surface"==t[n].dataset.paneType){var r=t[n].querySelector("canvas");r.dataset.render="solid"}e.events.on("pane.split",function(e,t){t.attrData("surface-render",e.attrData("surface-render"))})},["surface"])}(),function(){"use strict";function e(e,t){var n=e.surface.map[t.id],r=e.graphics.gl,i=t.clientWidth,o=t.clientHeight;r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.viewport(0,0,i,o);var a=e.surface.getRender(t);a&&a(n),e.surface.onRender(t,n);var s=t.getContext("2d");s&&(r.readPixels(0,0,i,o,r.RGBA,r.UNSIGNED_BYTE,n.buffer),n.imgData.data.set(n.buffer),s.putImageData(n.imgData,0,0))}var t=function(t){this.gl=GL.create({height:screen.height,width:screen.width}),this.gl.animate(),this.gl.ondraw=function(){for(var n=document.querySelectorAll("canvas"),r=0;r<n.length;r++)e(t,n[r])},this.gl.clearColor(.349,.349,.349,1),this.gl.enable(this.gl.DEPTH_TEST)};Modules.prototype.add("graphics",function(e){e.graphics=new t(e)})}(),function(){"use strict";var e=0,t=0;Modules.prototype.add("scene",function(n){n.scene=TreeNode.extend(),n.scene.addObject=function(t){t.primitive||(t.primitive=n.graphics.gl.TRIANGLES),t.model||(t.model=mat4.create()),t.type||(t.type="object"),t.name||(t.name="object_"+e++),this.add(t)},n.scene.addLight=function(e){e.model||(e.position=[0,0,0]),e.color||(e.color=[1,1,1]),e.intensity||(e.intensity=1),e.type||(e.type="light"),e.name||(e.name="light_"+t++),this.add(e)},n.scene.getObjects=function(){return this.dfs(function(e){return"object"===e.data.type})},n.scene.getLights=function(){return this.dfs(function(e){return"light"===e.data.type})},n.scene.addObject({mesh:Math.HalfEdgeCube()}),n.scene.addLight({position:[0,10,5]})},["graphics","math-halfEdge-cube"])}();
//# sourceMappingURL=cobweb.min.js.map
