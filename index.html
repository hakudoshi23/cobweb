<!DOCTYPE html>
<html>
    <head>
        <title>WebMesh</title>

        <script src="external/gl-matrix/gl-matrix-min.js"></script>
        <script src="external/litegl/litegl.min.js"></script>

        <link rel="stylesheet" href="dist/webmesh.min.css"></link>
        <script src="dist/webmesh.min.js"></script>

        <script type="text/javascript">
            var wm = null;
            window.addEventListener('load', function(){
                wm = new WebMesh({
                    container: {
                        selector: '#container'
                    }
                });

                wm.gl.animate();

                var object = {};
            	object.primitive = wm.gl.TRIANGLES;
            	object.model = mat4.create();
                object.mesh = GL.Mesh.cube();

            	var proj = mat4.create();
            	var view = mat4.create();
            	var model = mat4.create();
            	var mvp = mat4.create();
            	var temp = mat4.create();

            	mat4.perspective(proj, 45 * DEG2RAD, wm.gl.canvas.width / wm.gl.canvas.height, 0.1, 1000);
            	mat4.lookAt(view, [0,10,10],[0,0,0], [0,1,0]);

            	var shader = new Shader(
                    'precision highp float;\
            		attribute vec3 a_vertex;\
            		attribute vec3 a_normal;\
            		varying vec3 v_normal;\
            		uniform mat4 u_mvp;\
            		uniform mat4 u_model;\
            		void main() {\
            			v_normal = (u_model * vec4(a_normal,0.0)).xyz;\
            			gl_Position = u_mvp * vec4(a_vertex,1.0);\
            		}',
                    'precision highp float;\
            		varying vec3 v_normal;\
            		uniform vec3 u_lightvector;\
            		uniform vec4 u_color;\
            		void main() {\
            		  vec3 N = normalize(v_normal);\
            		  gl_FragColor = u_color * max(0.0, dot(u_lightvector,N));\
            		}'
                );

            	wm.gl.clearColor(0.4, 0.4, 0.4, 1);
            	wm.gl.enable(wm.gl.DEPTH_TEST);

            	var uniforms = {
            		u_color: [1, 1, 1, 1],
            		u_lightvector: vec3.normalize(vec3.create(),[1, 1, 1]),
            		u_model: model,
            		u_mvp: mvp
            	};

            	wm.gl.ondraw = function() {
            		wm.gl.clear(wm.gl.COLOR_BUFFER_BIT | wm.gl.DEPTH_BUFFER_BIT);

                    mat4.multiply(temp, view, object.model);
                    mat4.multiply(mvp, proj, temp);

                    uniforms.u_model = object.model;
                    shader.uniforms(uniforms).draw(object.mesh, object.primitive);
            	};

            	wm.gl.onupdate = function(dt) {
            		mat4.rotateY(object.model, object.model, dt * 0.2);
            	};
            });
        </script>
    </head>
    <body>
        <div id="container" style="width:900px;height:700px;margin:20px auto;"></div>
    </body>
</html>
